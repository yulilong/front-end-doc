<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTML转PDF方案 | 前端知识</title>
    <meta name="description" content="一个总结前端知识的文档网站">
    <link rel="icon" href="/logo.png">
  <script defer="defer" src="/static/jquery.slim.min.js"></script>
  <script defer="defer" src="/static/jquery.fancybox.min.js"></script>
  <link defer="defer" rel="stylesheet" type="text/css" href="/static/jquery.fancybox.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.76f153c4.css" as="style"><link rel="preload" href="/assets/js/app.2afb8482.js" as="script"><link rel="preload" href="/assets/js/46.9ed06d3b.js" as="script"><link rel="prefetch" href="/assets/js/10.0ef1013d.js"><link rel="prefetch" href="/assets/js/100.59669d01.js"><link rel="prefetch" href="/assets/js/101.741c2686.js"><link rel="prefetch" href="/assets/js/102.47149e7d.js"><link rel="prefetch" href="/assets/js/103.f1eaf177.js"><link rel="prefetch" href="/assets/js/104.f23808ff.js"><link rel="prefetch" href="/assets/js/105.f5bdad72.js"><link rel="prefetch" href="/assets/js/106.b8157b10.js"><link rel="prefetch" href="/assets/js/107.a275a057.js"><link rel="prefetch" href="/assets/js/108.4906ec1c.js"><link rel="prefetch" href="/assets/js/109.b21c5677.js"><link rel="prefetch" href="/assets/js/11.3ee5972a.js"><link rel="prefetch" href="/assets/js/110.11790a6f.js"><link rel="prefetch" href="/assets/js/111.519e46a2.js"><link rel="prefetch" href="/assets/js/112.856c72b2.js"><link rel="prefetch" href="/assets/js/113.1a9718fd.js"><link rel="prefetch" href="/assets/js/114.98562c57.js"><link rel="prefetch" href="/assets/js/115.dd09f294.js"><link rel="prefetch" href="/assets/js/116.3e697856.js"><link rel="prefetch" href="/assets/js/117.9ed54de6.js"><link rel="prefetch" href="/assets/js/118.837075a7.js"><link rel="prefetch" href="/assets/js/119.eeb7356e.js"><link rel="prefetch" href="/assets/js/12.ef92ad8b.js"><link rel="prefetch" href="/assets/js/120.d76e8c70.js"><link rel="prefetch" href="/assets/js/121.5490f8be.js"><link rel="prefetch" href="/assets/js/122.bf95df47.js"><link rel="prefetch" href="/assets/js/123.1246f4df.js"><link rel="prefetch" href="/assets/js/124.1b332371.js"><link rel="prefetch" href="/assets/js/125.e968eefc.js"><link rel="prefetch" href="/assets/js/126.41b0b42d.js"><link rel="prefetch" href="/assets/js/127.8d532027.js"><link rel="prefetch" href="/assets/js/128.e3d0dd45.js"><link rel="prefetch" href="/assets/js/129.2eec7742.js"><link rel="prefetch" href="/assets/js/13.5d83ca59.js"><link rel="prefetch" href="/assets/js/130.184a5326.js"><link rel="prefetch" href="/assets/js/131.55d5602a.js"><link rel="prefetch" href="/assets/js/132.0739ad32.js"><link rel="prefetch" href="/assets/js/133.eb282834.js"><link rel="prefetch" href="/assets/js/134.9df36c58.js"><link rel="prefetch" href="/assets/js/135.6d3b3c22.js"><link rel="prefetch" href="/assets/js/136.f6fc5239.js"><link rel="prefetch" href="/assets/js/137.13c0c004.js"><link rel="prefetch" href="/assets/js/138.d9558cc8.js"><link rel="prefetch" href="/assets/js/139.450241fe.js"><link rel="prefetch" href="/assets/js/14.bb2ca207.js"><link rel="prefetch" href="/assets/js/140.e1bf74b6.js"><link rel="prefetch" href="/assets/js/141.b02477b9.js"><link rel="prefetch" href="/assets/js/142.2d68a06d.js"><link rel="prefetch" href="/assets/js/143.c47820a5.js"><link rel="prefetch" href="/assets/js/144.17e6f31d.js"><link rel="prefetch" href="/assets/js/145.2e8592c6.js"><link rel="prefetch" href="/assets/js/146.720781fb.js"><link rel="prefetch" href="/assets/js/147.bf3ed75b.js"><link rel="prefetch" href="/assets/js/148.9505073e.js"><link rel="prefetch" href="/assets/js/149.f9dd6c7c.js"><link rel="prefetch" href="/assets/js/15.16c14ea6.js"><link rel="prefetch" href="/assets/js/150.90a127d0.js"><link rel="prefetch" href="/assets/js/151.9d50afd2.js"><link rel="prefetch" href="/assets/js/152.fbecf0f6.js"><link rel="prefetch" href="/assets/js/153.32c2bb94.js"><link rel="prefetch" href="/assets/js/154.3c5424d9.js"><link rel="prefetch" href="/assets/js/155.4587c969.js"><link rel="prefetch" href="/assets/js/156.b40288c2.js"><link rel="prefetch" href="/assets/js/157.edd410f1.js"><link rel="prefetch" href="/assets/js/158.ada22e21.js"><link rel="prefetch" href="/assets/js/159.ae4e1769.js"><link rel="prefetch" href="/assets/js/16.70266c95.js"><link rel="prefetch" href="/assets/js/160.1c2e95e3.js"><link rel="prefetch" href="/assets/js/161.764559ae.js"><link rel="prefetch" href="/assets/js/162.f3834de5.js"><link rel="prefetch" href="/assets/js/163.17919df8.js"><link rel="prefetch" href="/assets/js/164.a9b1a7d4.js"><link rel="prefetch" href="/assets/js/165.e649e97a.js"><link rel="prefetch" href="/assets/js/166.02532372.js"><link rel="prefetch" href="/assets/js/167.7d112130.js"><link rel="prefetch" href="/assets/js/168.90c0dfba.js"><link rel="prefetch" href="/assets/js/169.d313ed3c.js"><link rel="prefetch" href="/assets/js/17.1f842ac0.js"><link rel="prefetch" href="/assets/js/170.4d971d67.js"><link rel="prefetch" href="/assets/js/171.6a5296d2.js"><link rel="prefetch" href="/assets/js/172.388c5f2d.js"><link rel="prefetch" href="/assets/js/173.8724128a.js"><link rel="prefetch" href="/assets/js/174.0bee9e04.js"><link rel="prefetch" href="/assets/js/175.0e539288.js"><link rel="prefetch" href="/assets/js/176.69aebc77.js"><link rel="prefetch" href="/assets/js/177.e321e16b.js"><link rel="prefetch" href="/assets/js/178.7a6767c2.js"><link rel="prefetch" href="/assets/js/179.b1cd3d26.js"><link rel="prefetch" href="/assets/js/18.958e91d3.js"><link rel="prefetch" href="/assets/js/180.aa4e26e5.js"><link rel="prefetch" href="/assets/js/181.373fea9f.js"><link rel="prefetch" href="/assets/js/182.00faf1e3.js"><link rel="prefetch" href="/assets/js/183.f5084718.js"><link rel="prefetch" href="/assets/js/184.d853e461.js"><link rel="prefetch" href="/assets/js/185.b0233d58.js"><link rel="prefetch" href="/assets/js/186.46563f8c.js"><link rel="prefetch" href="/assets/js/187.8f099752.js"><link rel="prefetch" href="/assets/js/188.3d2adfff.js"><link rel="prefetch" href="/assets/js/189.56085996.js"><link rel="prefetch" href="/assets/js/19.29243772.js"><link rel="prefetch" href="/assets/js/190.74ee9249.js"><link rel="prefetch" href="/assets/js/191.2912c7b3.js"><link rel="prefetch" href="/assets/js/192.816999ff.js"><link rel="prefetch" href="/assets/js/193.66e79d51.js"><link rel="prefetch" href="/assets/js/194.a0aef591.js"><link rel="prefetch" href="/assets/js/195.ca729864.js"><link rel="prefetch" href="/assets/js/196.5f2550df.js"><link rel="prefetch" href="/assets/js/197.53a5a951.js"><link rel="prefetch" href="/assets/js/198.9b7fd80a.js"><link rel="prefetch" href="/assets/js/199.7d76d45a.js"><link rel="prefetch" href="/assets/js/20.65ee3cb2.js"><link rel="prefetch" href="/assets/js/200.beed8c2d.js"><link rel="prefetch" href="/assets/js/201.60704fe0.js"><link rel="prefetch" href="/assets/js/202.0f40a335.js"><link rel="prefetch" href="/assets/js/203.c4a08479.js"><link rel="prefetch" href="/assets/js/204.f281776c.js"><link rel="prefetch" href="/assets/js/205.486b8447.js"><link rel="prefetch" href="/assets/js/206.b9d6473d.js"><link rel="prefetch" href="/assets/js/207.0100e25c.js"><link rel="prefetch" href="/assets/js/208.1f4aeb54.js"><link rel="prefetch" href="/assets/js/209.421e2a33.js"><link rel="prefetch" href="/assets/js/21.f02a2061.js"><link rel="prefetch" href="/assets/js/210.1c1f9f92.js"><link rel="prefetch" href="/assets/js/211.033ec43d.js"><link rel="prefetch" href="/assets/js/212.eaedd29f.js"><link rel="prefetch" href="/assets/js/213.8fa26e5f.js"><link rel="prefetch" href="/assets/js/214.b09ab61f.js"><link rel="prefetch" href="/assets/js/215.ba27a46e.js"><link rel="prefetch" href="/assets/js/216.3d36839f.js"><link rel="prefetch" href="/assets/js/217.c408db8c.js"><link rel="prefetch" href="/assets/js/218.8d420404.js"><link rel="prefetch" href="/assets/js/219.024c3aff.js"><link rel="prefetch" href="/assets/js/22.77807269.js"><link rel="prefetch" href="/assets/js/220.5cd1fed8.js"><link rel="prefetch" href="/assets/js/221.c8398355.js"><link rel="prefetch" href="/assets/js/222.eee93b67.js"><link rel="prefetch" href="/assets/js/223.890a46b1.js"><link rel="prefetch" href="/assets/js/224.af9ae0f2.js"><link rel="prefetch" href="/assets/js/225.64543242.js"><link rel="prefetch" href="/assets/js/226.67eb4e8b.js"><link rel="prefetch" href="/assets/js/227.9dea1e95.js"><link rel="prefetch" href="/assets/js/228.9fd3cd8c.js"><link rel="prefetch" href="/assets/js/229.e3bb4f30.js"><link rel="prefetch" href="/assets/js/23.04033c47.js"><link rel="prefetch" href="/assets/js/230.fd5e90a4.js"><link rel="prefetch" href="/assets/js/231.77d39633.js"><link rel="prefetch" href="/assets/js/232.0fb9b697.js"><link rel="prefetch" href="/assets/js/233.9fd67d1e.js"><link rel="prefetch" href="/assets/js/234.df71f2f9.js"><link rel="prefetch" href="/assets/js/235.72c89c6a.js"><link rel="prefetch" href="/assets/js/236.71d9c1f7.js"><link rel="prefetch" href="/assets/js/237.291e0d2b.js"><link rel="prefetch" href="/assets/js/238.39113381.js"><link rel="prefetch" href="/assets/js/239.468bdffb.js"><link rel="prefetch" href="/assets/js/24.d5ebdf50.js"><link rel="prefetch" href="/assets/js/240.6a6ca3de.js"><link rel="prefetch" href="/assets/js/241.f9a26874.js"><link rel="prefetch" href="/assets/js/242.9d8553eb.js"><link rel="prefetch" href="/assets/js/25.56b8443d.js"><link rel="prefetch" href="/assets/js/26.c90580d1.js"><link rel="prefetch" href="/assets/js/27.ec93c7fa.js"><link rel="prefetch" href="/assets/js/28.38543972.js"><link rel="prefetch" href="/assets/js/29.2d9ac121.js"><link rel="prefetch" href="/assets/js/3.9c9ba874.js"><link rel="prefetch" href="/assets/js/30.566c00ec.js"><link rel="prefetch" href="/assets/js/31.840c7368.js"><link rel="prefetch" href="/assets/js/32.085a9b53.js"><link rel="prefetch" href="/assets/js/33.2568f008.js"><link rel="prefetch" href="/assets/js/34.c693b23c.js"><link rel="prefetch" href="/assets/js/35.0b12ec66.js"><link rel="prefetch" href="/assets/js/36.5de34291.js"><link rel="prefetch" href="/assets/js/37.316e55e2.js"><link rel="prefetch" href="/assets/js/38.fedb1c7b.js"><link rel="prefetch" href="/assets/js/39.3903f3e4.js"><link rel="prefetch" href="/assets/js/4.e2e10cba.js"><link rel="prefetch" href="/assets/js/40.b458a04d.js"><link rel="prefetch" href="/assets/js/41.51efbc84.js"><link rel="prefetch" href="/assets/js/42.5c079c5c.js"><link rel="prefetch" href="/assets/js/43.d67826ec.js"><link rel="prefetch" href="/assets/js/44.e4379bb2.js"><link rel="prefetch" href="/assets/js/45.d1573aa8.js"><link rel="prefetch" href="/assets/js/47.44c98776.js"><link rel="prefetch" href="/assets/js/48.8bcc4819.js"><link rel="prefetch" href="/assets/js/49.ad20e965.js"><link rel="prefetch" href="/assets/js/5.9862dc9a.js"><link rel="prefetch" href="/assets/js/50.e8fde2ac.js"><link rel="prefetch" href="/assets/js/51.73d7229f.js"><link rel="prefetch" href="/assets/js/52.250dc5fe.js"><link rel="prefetch" href="/assets/js/53.f604ad65.js"><link rel="prefetch" href="/assets/js/54.1c7de7b1.js"><link rel="prefetch" href="/assets/js/55.4d268d71.js"><link rel="prefetch" href="/assets/js/56.9da1ef8f.js"><link rel="prefetch" href="/assets/js/57.5a47f404.js"><link rel="prefetch" href="/assets/js/58.f02f1dd9.js"><link rel="prefetch" href="/assets/js/59.866dce11.js"><link rel="prefetch" href="/assets/js/6.ab1c77d5.js"><link rel="prefetch" href="/assets/js/60.b747b975.js"><link rel="prefetch" href="/assets/js/61.dbd99295.js"><link rel="prefetch" href="/assets/js/62.64069c98.js"><link rel="prefetch" href="/assets/js/63.ed8b0dd0.js"><link rel="prefetch" href="/assets/js/64.3acd796b.js"><link rel="prefetch" href="/assets/js/65.b9dbfb42.js"><link rel="prefetch" href="/assets/js/66.61b81117.js"><link rel="prefetch" href="/assets/js/67.8d82f096.js"><link rel="prefetch" href="/assets/js/68.e3a8f010.js"><link rel="prefetch" href="/assets/js/69.4f199ada.js"><link rel="prefetch" href="/assets/js/7.32aa26cb.js"><link rel="prefetch" href="/assets/js/70.5b5eccfe.js"><link rel="prefetch" href="/assets/js/71.a19b24f5.js"><link rel="prefetch" href="/assets/js/72.01636d1f.js"><link rel="prefetch" href="/assets/js/73.4ea8ca9c.js"><link rel="prefetch" href="/assets/js/74.624abc0f.js"><link rel="prefetch" href="/assets/js/75.7e0202b6.js"><link rel="prefetch" href="/assets/js/76.7aaabc49.js"><link rel="prefetch" href="/assets/js/77.90e5533f.js"><link rel="prefetch" href="/assets/js/78.3758ee0d.js"><link rel="prefetch" href="/assets/js/79.15d46be1.js"><link rel="prefetch" href="/assets/js/8.cdadef6d.js"><link rel="prefetch" href="/assets/js/80.952bd008.js"><link rel="prefetch" href="/assets/js/81.3f570b43.js"><link rel="prefetch" href="/assets/js/82.62e50e74.js"><link rel="prefetch" href="/assets/js/83.3bf5ea27.js"><link rel="prefetch" href="/assets/js/84.e89c9df3.js"><link rel="prefetch" href="/assets/js/85.b9ec2ec1.js"><link rel="prefetch" href="/assets/js/86.cf032aea.js"><link rel="prefetch" href="/assets/js/87.5b38d42a.js"><link rel="prefetch" href="/assets/js/88.95904b6f.js"><link rel="prefetch" href="/assets/js/89.700238a1.js"><link rel="prefetch" href="/assets/js/9.b8b9f88e.js"><link rel="prefetch" href="/assets/js/90.3371b61c.js"><link rel="prefetch" href="/assets/js/91.5ac22d50.js"><link rel="prefetch" href="/assets/js/92.5edf548a.js"><link rel="prefetch" href="/assets/js/93.7c2caa65.js"><link rel="prefetch" href="/assets/js/94.af97350f.js"><link rel="prefetch" href="/assets/js/95.977e351c.js"><link rel="prefetch" href="/assets/js/96.783365c1.js"><link rel="prefetch" href="/assets/js/97.1c56ba20.js"><link rel="prefetch" href="/assets/js/98.8bec8d2e.js"><link rel="prefetch" href="/assets/js/99.30c76886.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.102ccaf5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.76f153c4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="前端知识" class="logo"> <span class="site-name can-hide">前端知识</span></a> <div class="links" style="max-width:nullpx;"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/catalog.html" class="nav-link">目录</a></div><div class="nav-item"><a href="/doc/es6/" class="nav-link">ES6</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/js/" class="nav-link router-link-active">js</a></li><li class="dropdown-item"><!----> <a href="/doc/js/standardLibrary/" class="nav-link">js标准库</a></li><li class="dropdown-item"><!----> <a href="/doc/dom/" class="nav-link">dom操作文档</a></li><li class="dropdown-item"><!----> <a href="/doc/designPattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/doc/browserNetwork/" class="nav-link">浏览器</a></div><div class="nav-item"><a href="/doc/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/doc/react/" class="nav-link">react</a></div><div class="nav-item"><a href="/doc/vue/" class="nav-link">vue</a></div><div class="nav-item"><a href="/doc/typeScript/" class="nav-link">TypeScript</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/doc/node/" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/doc/tool/" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/doc/tool/echarts/" class="nav-link">echarts</a></li><li class="dropdown-item"><!----> <a href="/doc/problem/" class="nav-link">常见问题</a></li></ul></div></div> <a href="https://github.com/yulilong/front-end-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/catalog.html" class="nav-link">目录</a></div><div class="nav-item"><a href="/doc/es6/" class="nav-link">ES6</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/js/" class="nav-link router-link-active">js</a></li><li class="dropdown-item"><!----> <a href="/doc/js/standardLibrary/" class="nav-link">js标准库</a></li><li class="dropdown-item"><!----> <a href="/doc/dom/" class="nav-link">dom操作文档</a></li><li class="dropdown-item"><!----> <a href="/doc/designPattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/doc/browserNetwork/" class="nav-link">浏览器</a></div><div class="nav-item"><a href="/doc/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/doc/react/" class="nav-link">react</a></div><div class="nav-item"><a href="/doc/vue/" class="nav-link">vue</a></div><div class="nav-item"><a href="/doc/typeScript/" class="nav-link">TypeScript</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/doc/node/" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/doc/tool/" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/doc/tool/echarts/" class="nav-link">echarts</a></li><li class="dropdown-item"><!----> <a href="/doc/problem/" class="nav-link">常见问题</a></li></ul></div></div> <a href="https://github.com/yulilong/front-end-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/doc/js/" class="sidebar-link">JavaScript部分说明</a></li><li><a href="/doc/js/001-对象原型继承.html" class="sidebar-link">对象原型继承</a></li><li><a href="/doc/js/002-this_call_apply_bind.html" class="sidebar-link">this、call、apply、bind</a></li><li><a href="/doc/js/003-数据类型转换.html" class="sidebar-link">数据类型转换</a></li><li><a href="/doc/js/004-跨域.html" class="sidebar-link">跨域</a></li><li><a href="/doc/js/005-Ajax.html" class="sidebar-link">Ajax</a></li><li><a href="/doc/js/007-作用域-执行环境.html" class="sidebar-link">作用域</a></li><li><a href="/doc/js/008-排序算法.html" class="sidebar-link">排序算法</a></li><li><a href="/doc/js/009-获取标签宽高及实例.html" class="sidebar-link">获取标签的宽高及例子</a></li><li><a href="/doc/js/013-JS数字计算精度和显示.html" class="sidebar-link">Number运算精度和大数显示问题</a></li><li><a href="/doc/js/014-Web-Worker使用教程.html" class="sidebar-link">Web Worker 使用教程</a></li><li><a href="/doc/js/015-JS常见问题解决.html" class="sidebar-link">JS常见问题解决</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>JS效果-代码片段</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc/js/01-js-example/01-常用的代码片段.html" class="sidebar-link">常用代码片段</a></li><li><a href="/doc/js/01-js-example/02-示例1.html" class="sidebar-link">代码示例1</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>函数</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc/js/006-函数.html" class="sidebar-link">函数</a></li><li><a href="/doc/js/006-1函数柯里化.html" class="sidebar-link">函数柯里化</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JS代码执行机制和事件循环</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>高级</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>文章</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc/js/blog/001-JS常用的60余种工具方法.html" class="sidebar-link">JS常用的60余种工具方法</a></li><li><a href="/doc/js/blog/002-js数据类型判断.html" class="sidebar-link">JS数据类型判断</a></li><li><a href="/doc/js/blog/003-js开启摄像头照相人脸识别.html" class="sidebar-link">页面开启摄像头照相</a></li><li><a href="/doc/js/blog/004-浏览器控制台反调试.html" class="sidebar-link">浏览器控制台反调试</a></li><li><a href="/doc/js/blog/006-JS调用iframe中页面dom.html" class="sidebar-link">前端JS调用iframe中页面事件实现</a></li><li><a href="/doc/js/blog/007-html转pdf方案.html" class="one-level one-level-active active sidebar-link">HTML转PDF方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/js/blog/007-html转pdf方案.html#_1-html转pdf的场景" class="sidebar-link">1. HTML转PDF的场景</a></li><li class="sidebar-sub-header"><a href="/doc/js/blog/007-html转pdf方案.html#_2-snapdom-介绍" class="sidebar-link">2. snapdom 介绍</a></li><li class="sidebar-sub-header"><a href="/doc/js/blog/007-html转pdf方案.html#_3-jspdf-介绍" class="sidebar-link">3. jsPDF 介绍</a></li><li class="sidebar-sub-header"><a href="/doc/js/blog/007-html转pdf方案.html#_4-snapdom-jspdf-组合的优势" class="sidebar-link">4. snapdom + jsPDF 组合的优势</a></li><li class="sidebar-sub-header"><a href="/doc/js/blog/007-html转pdf方案.html#_5-实际用例" class="sidebar-link">5. 实际用例</a></li><li class="sidebar-sub-header"><a href="/doc/js/blog/007-html转pdf方案.html#_6-snapdom-对比-html2canvas" class="sidebar-link">6. SnapDOM 对比 html2canvas</a></li><li class="sidebar-sub-header"><a href="/doc/js/blog/007-html转pdf方案.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/doc/js/blog/007-html转pdf方案.html#其他参考" class="sidebar-link">其他参考</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><p></p><div class="table-of-contents"><ul><li><a href="#_1-html转pdf的场景">1. HTML转PDF的场景</a></li><li><a href="#_2-snapdom-介绍">2. snapdom 介绍</a><ul><li><a href="#核心优势">核心优势</a></li><li><a href="#基础用法">基础用法</a></li></ul></li><li><a href="#_3-jspdf-介绍">3. jsPDF 介绍</a><ul><li><a href="#核心特点">核心特点</a></li><li><a href="#基础用法">基础用法</a></li><li><a href="#a4-尺寸常量">A4 尺寸常量</a></li></ul></li><li><a href="#_4-snapdom-jspdf-组合的优势">4. snapdom + jsPDF 组合的优势</a></li><li><a href="#_5-实际用例">5. 实际用例</a><ul><li><a href="#_5-1-dom-截图（snapdom）">5.1 DOM 截图（snapdom）</a></li><li><a href="#_5-2-图片分页（canvas）">5.2 图片分页（Canvas）</a></li><li><a href="#_5-3-step-3：创建-pdf（jspdf）">5.3 Step 3：创建 PDF（jsPDF）</a></li><li><a href="#_5-4-主导出函数">5.4 主导出函数</a></li><li><a href="#_5-5-在组件中使用">5.5 在组件中使用</a></li><li><a href="#_5-6-完整效果">5.6 完整效果</a></li></ul></li><li><a href="#_6-snapdom-对比-html2canvas">6. SnapDOM 对比 html2canvas</a><ul><li><a href="#_6-1-什么时候选择-html2canvas？">6.1 什么时候选择 html2canvas？</a></li></ul></li><li><a href="#总结">总结</a></li><li><a href="#其他参考">其他参考</a></li></ul></div><p></p> <p>[TOC]</p> <h1 id="html转pdf方案"><a href="#html转pdf方案" aria-hidden="true" class="header-anchor">#</a> HTML转PDF方案</h1> <p>本文整理、转载自掘金：https://juejin.cn/post/7576608733612425242</p> <h2 id="_1-html转pdf的场景"><a href="#_1-html转pdf的场景" aria-hidden="true" class="header-anchor">#</a> 1. HTML转PDF的场景</h2> <p>在现代 Web 应用中，<strong>HTML 转 PDF</strong> 是一个非常常见的需求场景：</p> <ol><li><strong>客服系统</strong>：导出聊天记录用于存档或投诉处理</li> <li><strong>电商平台</strong>：生成订单详情、发票等 PDF 文档</li> <li><strong>报表系统</strong>：将可视化图表和数据导出为 PDF 报告</li> <li><strong>在线文档</strong>：支持用户将网页内容离线保存</li> <li><strong>合同签署</strong>：生成合同 PDF 用于电子签名</li></ol> <p>然而，实现一个<strong>高质量</strong>的 HTML 转 PDF 功能并不简单。我们面临以下挑战：</p> <table><thead><tr><th>挑战</th> <th>描述</th></tr></thead> <tbody><tr><td><strong>样式还原</strong></td> <td>CSS 样式、字体、渐变等能否完美呈现？</td></tr> <tr><td><strong>分页处理</strong></td> <td>长内容如何智能分页，避免内容被截断？</td></tr> <tr><td><strong>清晰度</strong></td> <td>导出的 PDF 是否足够清晰，尤其在打印时？</td></tr> <tr><td><strong>性能</strong></td> <td>大量内容（如 1000 条消息）能否快速导出？</td></tr> <tr><td><strong>兼容性</strong></td> <td>不同浏览器表现是否一致？</td></tr></tbody></table> <p>传统的 <code>html2canvas</code> + <code>jsPDF</code> 方案虽然能用，但在<strong>样式还原度</strong>和<strong>截图质量</strong>上存在明显不足。</p> <p>今天笔者介绍一套新解决方案：<strong>snapdom + jsPDF</strong>。</p> <h2 id="_2-snapdom-介绍"><a href="#_2-snapdom-介绍" aria-hidden="true" class="header-anchor">#</a> 2. snapdom 介绍</h2> <p><a href="https://github.com/zumerlab/snapdom" target="_blank" rel="noopener noreferrer">SnapDOM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个现代化的 DOM 截图库，它的核心特点是：<code>DOM Element → **Canvas**/PNG/SVG</code></p> <h3 id="核心优势"><a href="#核心优势" aria-hidden="true" class="header-anchor">#</a> 核心优势</h3> <ol><li><strong>高保真截图</strong>：完美还原 CSS 样式，包括 flexbox、grid、渐变、阴影等</li> <li><strong>多种输出格式</strong>：支持 Canvas、PNG、SVG 等多种格式</li> <li><strong>高清缩放</strong>：通过 <code>scale</code> 参数实现 2x/3x 高清截图</li> <li><strong>体积小巧</strong>：压缩后仅 ~20KB</li></ol> <h3 id="基础用法"><a href="#基础用法" aria-hidden="true" class="header-anchor">#</a> 基础用法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> snapdom <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@zumer/snapdom'</span><span class="token punctuation">;</span>

<span class="token comment">// 获取 DOM 元素</span>
<span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.my-element'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 截图</span>
<span class="token keyword">const</span> capture <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">snapdom</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  scale<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>      <span class="token comment">// 2倍清晰度</span>
  quality<span class="token punctuation">:</span> <span class="token number">0.95</span>  <span class="token comment">// PNG 质量</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出方式</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token keyword">await</span> capture<span class="token punctuation">.</span><span class="token function">toCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Canvas 元素</span>
<span class="token keyword">const</span> imgEl <span class="token operator">=</span> <span class="token keyword">await</span> capture<span class="token punctuation">.</span><span class="token function">toPng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &lt;img&gt; 元素，src 为 data URL</span>
<span class="token keyword">const</span> svgStr <span class="token operator">=</span> <span class="token keyword">await</span> capture<span class="token punctuation">.</span><span class="token function">toSvg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// SVG 字符串</span>
</code></pre></div><p><strong>关键参数说明</strong></p> <table><thead><tr><th>参数</th> <th>类型</th> <th>默认值</th> <th>说明</th></tr></thead> <tbody><tr><td><code>scale</code></td> <td>number</td> <td>1</td> <td>缩放倍数，2 表示 2 倍清晰度</td></tr> <tr><td><code>quality</code></td> <td>number</td> <td>0.92</td> <td>图片质量，范围 0-1</td></tr></tbody></table> <p>更多详细内容请看:https://github.com/zumerlab/snapdom/blob/main/README_CN.md</p> <h2 id="_3-jspdf-介绍"><a href="#_3-jspdf-介绍" aria-hidden="true" class="header-anchor">#</a> 3. jsPDF 介绍</h2> <p><a href="https://github.com/parallax/jsPDF" target="_blank" rel="noopener noreferrer">jsPDF<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是最流行的 JavaScript PDF 生成库，支持在浏览器端直接创建 PDF 文件。</p> <h3 id="核心特点"><a href="#核心特点" aria-hidden="true" class="header-anchor">#</a> 核心特点</h3> <ol><li><strong>纯前端方案</strong>：无需服务端，浏览器直接生成</li> <li><strong>功能丰富</strong>：支持文本、图片、表格、链接等</li> <li><strong>多种尺寸</strong>：A4、Letter 等标准纸张格式</li> <li><strong>插件生态</strong>：支持 AutoTable 等扩展插件</li></ol> <h3 id="基础用法-2"><a href="#基础用法-2" aria-hidden="true" class="header-anchor">#</a> 基础用法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> jsPDF <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'jspdf'</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 PDF 实例</span>
<span class="token keyword">const</span> pdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">jsPDF</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  orientation<span class="token punctuation">:</span> <span class="token string">'portrait'</span><span class="token punctuation">,</span>  <span class="token comment">// 纵向</span>
  unit<span class="token punctuation">:</span> <span class="token string">'mm'</span><span class="token punctuation">,</span>               <span class="token comment">// 单位：毫米</span>
  format<span class="token punctuation">:</span> <span class="token string">'a4'</span><span class="token punctuation">,</span>             <span class="token comment">// A4 纸张</span>
  compress<span class="token punctuation">:</span> <span class="token boolean">true</span>            <span class="token comment">// 启用压缩</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 添加图片</span>
pdf<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span>
  imageDataUrl<span class="token punctuation">,</span>  <span class="token comment">// Base64 图片数据</span>
  <span class="token string">'PNG'</span><span class="token punctuation">,</span>         <span class="token comment">// 图片格式</span>
  <span class="token number">10</span><span class="token punctuation">,</span>            <span class="token comment">// X 坐标（mm）</span>
  <span class="token number">10</span><span class="token punctuation">,</span>            <span class="token comment">// Y 坐标（mm）</span>
  <span class="token number">190</span><span class="token punctuation">,</span>           <span class="token comment">// 宽度（mm）</span>
  <span class="token number">100</span>            <span class="token comment">// 高度（mm）</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 添加新页面</span>
pdf<span class="token punctuation">.</span><span class="token function">addPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 保存文件</span>
pdf<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">'output.pdf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="a4-尺寸常量"><a href="#a4-尺寸常量" aria-hidden="true" class="header-anchor">#</a> A4 尺寸常量</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// A4 标准尺寸（单位：mm）</span>
<span class="token keyword">const</span> <span class="token constant">A4_WIDTH_MM</span> <span class="token operator">=</span> <span class="token number">210</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">A4_HEIGHT_MM</span> <span class="token operator">=</span> <span class="token number">297</span><span class="token punctuation">;</span>
<span class="token comment">// 页面边距</span>
<span class="token keyword">const</span> <span class="token constant">MARGIN_MM</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">// 可用内容区域</span>
<span class="token keyword">const</span> <span class="token constant">CONTENT_WIDTH_MM</span> <span class="token operator">=</span> <span class="token number">190</span><span class="token punctuation">;</span>   <span class="token comment">// 210 - 10*2</span>
<span class="token keyword">const</span> <span class="token constant">CONTENT_HEIGHT_MM</span> <span class="token operator">=</span> <span class="token number">277</span><span class="token punctuation">;</span>  <span class="token comment">// 297 - 10*2</span>
</code></pre></div><h2 id="_4-snapdom-jspdf-组合的优势"><a href="#_4-snapdom-jspdf-组合的优势" aria-hidden="true" class="header-anchor">#</a> 4. snapdom + jsPDF 组合的优势</h2> <p><img src="/assets/img/007-01.c21dc5ce.png" alt></p> <h2 id="_5-实际用例"><a href="#_5-实际用例" aria-hidden="true" class="header-anchor">#</a> 5. 实际用例</h2> <p>笔者写一个IM产品中 MessageList 消息导出DEMO。接下来，我们通过一个完整的<strong>客服消息列表导出</strong>案例，讲解如何使用 snapdom + jsPDF 实现 HTML 转 PDF。</p> <p><strong>项目结构</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>src/
├── components/
│   ├── MessageList.tsx      <span class="token comment"># 消息列表组件</span>
│   └── MessageList.css      <span class="token comment"># 消息列表样式</span>
├── services/
│   └── messageExportService.ts  <span class="token comment"># PDF 导出服务（核心）</span>
└── App.tsx
</code></pre></div><p><strong>核心流程</strong></p> <p>整个导出过程分为 <strong>4 个步骤</strong>：</p> <p><img src="/assets/img/007-02.1335ceec.png" alt></p> <h3 id="_5-1-dom-截图（snapdom）"><a href="#_5-1-dom-截图（snapdom）" aria-hidden="true" class="header-anchor">#</a> 5.1 DOM 截图（snapdom）</h3> <p>第一步，使用 snapdom 将整个消息列表 DOM 转换为高清 PNG 图片。</p> <p><strong>关键点解析</strong>：</p> <ol><li><strong>临时修改样式</strong>：将 <code>overflow</code>、<code>height</code>、<code>maxHeight</code> 临时设置为可见状态，确保截取完整内容</li> <li><strong>scale: 2</strong>：2 倍缩放提高清晰度，打印时效果更佳</li> <li><strong>降级处理</strong>：<code>toPng()</code> 失败时自动回退到 <code>toCanvas()</code></li> <li><strong>样式恢复</strong>：截图完成后恢复原始样式</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// messageExportService.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> snapdom <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@zumer/snapdom'</span><span class="token punctuation">;</span>

<span class="token comment">// 图片质量配置</span>
<span class="token keyword">const</span> <span class="token constant">IMAGE_QUALITY</span> <span class="token operator">=</span> <span class="token number">0.95</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">IMAGE_FORMAT</span> <span class="token operator">=</span> <span class="token string">'image/png'</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 将 DOM 元素转换为图片
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">captureElementToImage</span><span class="token punctuation">(</span>
  element<span class="token punctuation">:</span> HTMLElement<span class="token punctuation">,</span>
  quality<span class="token punctuation">:</span> number <span class="token operator">=</span> <span class="token constant">IMAGE_QUALITY</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'开始截图...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 保存原始样式</span>
  <span class="token keyword">const</span> originalOverflow <span class="token operator">=</span> element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow<span class="token punctuation">;</span>
  <span class="token keyword">const</span> originalHeight <span class="token operator">=</span> element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
  <span class="token keyword">const</span> originalMaxHeight <span class="token operator">=</span> element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>maxHeight<span class="token punctuation">;</span>

  <span class="token comment">// 临时设置样式，确保完整截图</span>
  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'visible'</span><span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">'auto'</span><span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>maxHeight <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 核心：使用 snapdom 进行截图</span>
    <span class="token keyword">const</span> capture <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">snapdom</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      scale<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>        <span class="token comment">// 2倍清晰度</span>
      quality<span class="token punctuation">:</span> quality
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 优先使用 toPng()</span>
    <span class="token keyword">const</span> imgElement <span class="token operator">=</span> <span class="token keyword">await</span> capture<span class="token punctuation">.</span><span class="token function">toPng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> dataUrl <span class="token operator">=</span> imgElement<span class="token punctuation">.</span>src<span class="token punctuation">;</span>

    <span class="token comment">// 验证数据有效性</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dataUrl <span class="token operator">||</span> dataUrl<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'toPng 返回无效，尝试 toCanvas...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token keyword">await</span> capture<span class="token punctuation">.</span><span class="token function">toCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token constant">IMAGE_FORMAT</span><span class="token punctuation">,</span> quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'截图成功，大小:'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>dataUrl<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'KB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> dataUrl<span class="token punctuation">;</span>

  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token comment">// 恢复原始样式</span>
    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> originalOverflow<span class="token punctuation">;</span>
    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> originalHeight<span class="token punctuation">;</span>
    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>maxHeight <span class="token operator">=</span> originalMaxHeight<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-2-图片分页（canvas）"><a href="#_5-2-图片分页（canvas）" aria-hidden="true" class="header-anchor">#</a> 5.2 图片分页（Canvas）</h3> <p>长图片需要按照 A4 页面高度进行分割，这是最复杂的一步。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 尺寸常量</span>
<span class="token keyword">const</span> <span class="token constant">A4_WIDTH_MM</span> <span class="token operator">=</span> <span class="token number">210</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">A4_HEIGHT_MM</span> <span class="token operator">=</span> <span class="token number">297</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PDF_MARGIN_MM</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PDF_CONTENT_WIDTH_MM</span> <span class="token operator">=</span> <span class="token constant">A4_WIDTH_MM</span> <span class="token operator">-</span> <span class="token constant">PDF_MARGIN_MM</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">// 190mm</span>
<span class="token keyword">const</span> <span class="token constant">PDF_CONTENT_HEIGHT_MM</span> <span class="token operator">=</span> <span class="token constant">A4_HEIGHT_MM</span> <span class="token operator">-</span> <span class="token constant">PDF_MARGIN_MM</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 277mm</span>

<span class="token comment">// 1mm = 3.7795275590551 像素（96 DPI）</span>
<span class="token keyword">const</span> <span class="token constant">MM_TO_PX</span> <span class="token operator">=</span> <span class="token number">3.7795275590551</span><span class="token punctuation">;</span>

<span class="token comment">// 分页后的图片数据</span>
<span class="token keyword">interface</span> <span class="token class-name">PageImageData</span> <span class="token punctuation">{</span>
  dataUrl<span class="token punctuation">:</span> string<span class="token punctuation">;</span>
  width<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
  height<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 将长图片分割成多个 A4 页面
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">splitImageIntoPages</span><span class="token punctuation">(</span>
  imageDataUrl<span class="token punctuation">:</span> string
<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span>PageImageData<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">'anonymous'</span><span class="token punctuation">;</span>

    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> pages<span class="token punctuation">:</span> PageImageData<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> originalWidth <span class="token operator">=</span> img<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
      <span class="token keyword">const</span> originalHeight <span class="token operator">=</span> img<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

      <span class="token comment">// 将 A4 内容区域转换为像素（考虑 scale=2）</span>
      <span class="token keyword">const</span> pageContentHeightPx <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>
        <span class="token constant">PDF_CONTENT_HEIGHT_MM</span> <span class="token operator">*</span> <span class="token constant">MM_TO_PX</span> <span class="token operator">*</span> <span class="token number">2</span>  <span class="token comment">// scale=2</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> pageContentWidthPx <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>
        <span class="token constant">PDF_CONTENT_WIDTH_MM</span> <span class="token operator">*</span> <span class="token constant">MM_TO_PX</span> <span class="token operator">*</span> <span class="token number">2</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 计算缩放比例（图片宽度适配页面宽度）</span>
      <span class="token keyword">const</span> widthScale <span class="token operator">=</span> pageContentWidthPx <span class="token operator">/</span> originalWidth<span class="token punctuation">;</span>
      <span class="token keyword">const</span> scaledHeight <span class="token operator">=</span> originalHeight <span class="token operator">*</span> widthScale<span class="token punctuation">;</span>

      <span class="token comment">// 计算总页数</span>
      <span class="token keyword">const</span> totalPages <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>scaledHeight <span class="token operator">/</span> pageContentHeightPx<span class="token punctuation">)</span><span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`原始尺寸: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>originalWidth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>originalHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`缩放后高度: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scaledHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, 总页数: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>totalPages<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 逐页裁剪</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> pageIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> pageIndex <span class="token operator">&lt;</span> totalPages<span class="token punctuation">;</span> pageIndex<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> startY <span class="token operator">=</span> pageIndex <span class="token operator">*</span> pageContentHeightPx<span class="token punctuation">;</span>
        <span class="token keyword">const</span> endY <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>startY <span class="token operator">+</span> pageContentHeightPx<span class="token punctuation">,</span> scaledHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> currentPageHeight <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>endY <span class="token operator">-</span> startY<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 计算源图片对应的区域</span>
        <span class="token keyword">const</span> sourceStartY <span class="token operator">=</span> startY <span class="token operator">/</span> widthScale<span class="token punctuation">;</span>
        <span class="token keyword">const</span> sourceHeight <span class="token operator">=</span> currentPageHeight <span class="token operator">/</span> widthScale<span class="token punctuation">;</span>

        <span class="token comment">// 创建新 Canvas</span>
        <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>

        canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> pageContentWidthPx<span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> currentPageHeight<span class="token punctuation">;</span>

        <span class="token comment">// 高质量渲染</span>
        ctx<span class="token punctuation">.</span>imageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>imageSmoothingQuality <span class="token operator">=</span> <span class="token string">'high'</span><span class="token punctuation">;</span>

        <span class="token comment">// 绘制当前页内容</span>
        ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
          img<span class="token punctuation">,</span>
          <span class="token number">0</span><span class="token punctuation">,</span> sourceStartY<span class="token punctuation">,</span>           <span class="token comment">// 源图片起始位置</span>
          originalWidth<span class="token punctuation">,</span> sourceHeight<span class="token punctuation">,</span> <span class="token comment">// 源图片尺寸</span>
          <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>                        <span class="token comment">// 目标起始位置</span>
          pageContentWidthPx<span class="token punctuation">,</span> currentPageHeight <span class="token comment">// 目标尺寸</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 转换为 data URL</span>
        <span class="token keyword">const</span> pageDataUrl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token constant">IMAGE_FORMAT</span><span class="token punctuation">,</span> <span class="token constant">IMAGE_QUALITY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        pages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          dataUrl<span class="token punctuation">:</span> pageDataUrl<span class="token punctuation">,</span>
          width<span class="token punctuation">:</span> pageContentWidthPx<span class="token punctuation">,</span>
          height<span class="token punctuation">:</span> currentPageHeight
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`第 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>totalPages<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 页处理完成`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>pages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'图片加载失败'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> imageDataUrl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>分页算法图解</strong>：</p> <div class="language-scss extra-class"><pre class="language-scss"><code>原始长图 <span class="token punctuation">(</span>假设 5000px 高<span class="token punctuation">)</span>
┌───────────────────┐
│                   │ ─┐
│      Page 1       │  │ 1046px <span class="token punctuation">(</span>277mm × 3.78 × 2<span class="token punctuation">)</span>
│                   │ ─┘
├───────────────────┤
│                   │ ─┐
│      Page 2       │  │ 1046px
│                   │ ─┘
├───────────────────┤
│                   │ ─┐
│      Page 3       │  │ 1046px
│                   │ ─┘
├───────────────────┤
│                   │ ─┐
│      Page 4       │  │ 1046px
│                   │ ─┘
├───────────────────┤
│      Page 5       │ ── 剩余 816px
│                   │
└───────────────────┘
</code></pre></div><h3 id="_5-3-step-3：创建-pdf（jspdf）"><a href="#_5-3-step-3：创建-pdf（jspdf）" aria-hidden="true" class="header-anchor">#</a> 5.3 Step 3：创建 PDF（jsPDF）</h3> <p>将分页后的图片逐一添加到 PDF 中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> jsPDF <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'jspdf'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 从分页图片创建 PDF
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createPdfFromPages</span><span class="token punctuation">(</span>pages<span class="token punctuation">:</span> PageImageData<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> jsPDF <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">jsPDF</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    orientation<span class="token punctuation">:</span> <span class="token string">'portrait'</span><span class="token punctuation">,</span>
    unit<span class="token punctuation">:</span> <span class="token string">'mm'</span><span class="token punctuation">,</span>
    format<span class="token punctuation">:</span> <span class="token string">'a4'</span><span class="token punctuation">,</span>
    compress<span class="token punctuation">:</span> <span class="token boolean">true</span>  <span class="token comment">// 启用压缩，减小文件体积</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>pages<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'没有可添加的页面'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  pages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 第一页直接用，后续需要 addPage</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      pdf<span class="token punctuation">.</span><span class="token function">addPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 像素转毫米（考虑 scale=2）</span>
    <span class="token keyword">const</span> scaleFactor <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> pageHeightMm <span class="token operator">=</span> page<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token constant">MM_TO_PX</span> <span class="token operator">/</span> scaleFactor<span class="token punctuation">;</span>

    <span class="token comment">// 图片适配内容区域宽度</span>
    <span class="token keyword">const</span> finalWidth <span class="token operator">=</span> <span class="token constant">PDF_CONTENT_WIDTH_MM</span><span class="token punctuation">;</span>  <span class="token comment">// 190mm</span>
    <span class="token keyword">const</span> finalHeight <span class="token operator">=</span> pageHeightMm<span class="token punctuation">;</span>

    <span class="token comment">// 位置：左上角对齐，保留 10mm 边距</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token constant">PDF_MARGIN_MM</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token constant">PDF_MARGIN_MM</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`添加第 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 页: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>finalWidth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>finalHeight<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">mm`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 添加图片到 PDF</span>
    pdf<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>dataUrl<span class="token punctuation">,</span> <span class="token string">'PNG'</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> finalWidth<span class="token punctuation">,</span> finalHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> pdf<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-4-主导出函数"><a href="#_5-4-主导出函数" aria-hidden="true" class="header-anchor">#</a> 5.4 主导出函数</h3> <p>将以上步骤串联起来，提供统一的导出接口。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">interface</span> <span class="token class-name">ExportConfig</span> <span class="token punctuation">{</span>
  targetSelector<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>   <span class="token comment">// CSS 选择器</span>
  filename<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>        <span class="token comment">// 文件名</span>
  quality<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>         <span class="token comment">// 图片质量</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 主导出函数
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">exportMessagesToPdf</span><span class="token punctuation">(</span>config<span class="token punctuation">:</span> ExportConfig<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> </span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    targetSelector<span class="token punctuation">,</span>
    filename <span class="token operator">=</span> <span class="token string">'messages.pdf'</span><span class="token punctuation">,</span>
    quality <span class="token operator">=</span> <span class="token constant">IMAGE_QUALITY</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> config<span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'=== 开始导出 PDF ==='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 1. 获取目标元素</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>targetSelector<span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`元素未找到: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>targetSelector<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'元素尺寸:'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    width<span class="token punctuation">:</span> element<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">,</span>
    height<span class="token punctuation">:</span> element<span class="token punctuation">.</span>scrollHeight
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2. DOM 截图</span>
  <span class="token keyword">const</span> imageDataUrl <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">captureElementToImage</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'截图完成，大小:'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>imageDataUrl<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'KB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 3. 图片分页</span>
  <span class="token keyword">const</span> pages <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">splitImageIntoPages</span><span class="token punctuation">(</span>imageDataUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`分页完成，共 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pages<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 页`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 4. 创建 PDF</span>
  <span class="token keyword">const</span> pdf <span class="token operator">=</span> <span class="token function">createPdfFromPages</span><span class="token punctuation">(</span>pages<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 5. 保存文件</span>
  pdf<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'=== 导出完成 ==='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token plain-text">
</span></code></pre></div><h3 id="_5-5-在组件中使用"><a href="#_5-5-在组件中使用" aria-hidden="true" class="header-anchor">#</a> 5.5 在组件中使用</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// MessageList.tsx</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> exportMessagesToPdf <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../services/messageExportService'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> MessageList<span class="token punctuation">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> messageListRef <span class="token operator">=</span> useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HTMLDivElement</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">(null);
  const [isExporting, setIsExporting] = useState(false);

  const handleExportToPdf = useCallback(async () =&gt; </span><span class="token punctuation">{</span>
    <span class="token function">setIsExporting</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 生成带时间戳的文件名</span>
      <span class="token keyword">const</span> timestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[:.]/g</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> filename <span class="token operator">=</span> <span class="token template-string"><span class="token string">`messages-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>timestamp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.pdf`</span></span><span class="token punctuation">;</span>

      <span class="token keyword">await</span> <span class="token function">exportMessagesToPdf</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        targetSelector<span class="token punctuation">:</span> <span class="token string">'.message-list-container'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">,</span>
        quality<span class="token punctuation">:</span> <span class="token number">0.95</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'导出失败:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'导出失败，请重试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token function">setIsExporting</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token plain-text">, []);

  return (
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>message-list-container<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>messageListRef<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>message-list-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">消息记录</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>export-button<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleExportToPdf<span class="token punctuation">}</span></span>
          <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>isExporting<span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span>isExporting <span class="token operator">?</span> <span class="token string">'导出中...'</span> <span class="token punctuation">:</span> <span class="token string">'导出 PDF'</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>message-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>messages<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>message <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MessageItem</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>message<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span> <span class="token attr-name">message</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  );
};
</span></code></pre></div><h3 id="_5-6-完整效果"><a href="#_5-6-完整效果" aria-hidden="true" class="header-anchor">#</a> 5.6 完整效果</h3> <p>运行项目后，点击「导出 PDF」按钮：</p> <ol><li>控制台显示详细的导出日志</li> <li>自动计算页数并分页</li> <li>生成高清 PDF 文件并自动下载</li></ol> <div class="language-markdown extra-class"><pre class="language-markdown"><code>=== 开始导出 PDF ===
目标选择器: .message-list-container
元素尺寸: { width: 600, height: 8500 }
开始截图...
截图完成，大小: 2847.65 KB
分页完成，共 8 页
添加第 1 页: 190x277.00mm
添加第 2 页: 190x277.00mm
...
添加第 <span class="token title important">8 页: 190x156.32mm
<span class="token punctuation">===</span></span> 导出完成 ===
</code></pre></div><h2 id="_6-snapdom-对比-html2canvas"><a href="#_6-snapdom-对比-html2canvas" aria-hidden="true" class="header-anchor">#</a> 6. SnapDOM 对比 html2canvas</h2> <p>为什么选择 SnapDOM 而不是更流行的 html2canvas？让我们来对比一下：</p> <table><thead><tr><th>对比维度</th> <th>SnapDOM</th> <th>html2canvas</th></tr></thead> <tbody><tr><td><strong>样式还原</strong></td> <td>★★★★★ 接近完美</td> <td>★★★☆☆ 部分样式丢失</td></tr> <tr><td><strong>Flexbox/Grid</strong></td> <td>✅ 完美支持</td> <td>⚠️ 部分问题</td></tr> <tr><td><strong>渐变背景</strong></td> <td>✅ 完美支持</td> <td>⚠️ 可能失真</td></tr> <tr><td><strong>阴影效果</strong></td> <td>✅ 完美支持</td> <td>⚠️ 部分丢失</td></tr> <tr><td><strong>自定义字体</strong></td> <td>✅ 支持</td> <td>⚠️ 需要额外处理</td></tr> <tr><td><strong>SVG 支持</strong></td> <td>✅ 原生支持</td> <td>⚠️ 有限支持</td></tr> <tr><td><strong>输出格式</strong></td> <td>PNG/Canvas/SVG</td> <td>Canvas/PNG</td></tr> <tr><td><strong>包大小</strong></td> <td>~20KB</td> <td>~60KB</td></tr> <tr><td><strong>维护状态</strong></td> <td>活跃更新</td> <td>较少更新</td></tr> <tr><td><strong>API 设计</strong></td> <td>现代 Promise</td> <td>回调 + Promise</td></tr></tbody></table> <p><strong>代码对比</strong>：</p> <p><strong>html2canvas 方式</strong>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> html2canvas <span class="token keyword">from</span> <span class="token string">'html2canvas'</span><span class="token punctuation">;</span>

<span class="token comment">// 需要处理各种兼容性问题</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">html2canvas</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  scale<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  useCORS<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  logging<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  allowTaint<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  foreignObjectRendering<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 可能不生效</span>
  <span class="token comment">// 还需要处理字体、SVG 等问题...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> dataUrl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>SnapDOM 方式</strong>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> snapdom <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@zumer/snapdom'</span><span class="token punctuation">;</span>

<span class="token comment">// 简洁的 API，无需额外配置</span>
<span class="token keyword">const</span> capture <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">snapdom</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  scale<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  quality<span class="token punctuation">:</span> <span class="token number">0.95</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> dataUrl <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> capture<span class="token punctuation">.</span><span class="token function">toPng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src<span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-1-什么时候选择-html2canvas？"><a href="#_6-1-什么时候选择-html2canvas？" aria-hidden="true" class="header-anchor">#</a> 6.1 什么时候选择 html2canvas？</h3> <p>虽然 SnapDOM 在大多数场景下更优秀，但 html2canvas 在以下情况可能更适合：</p> <ol><li><strong>项目已在使用</strong>：迁移成本较高</li> <li><strong>简单场景</strong>：只需截取简单文本，无复杂样式</li> <li><strong>团队熟悉度</strong>：团队对 html2canvas 更熟悉</li></ol> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p><strong>核心要点回顾</strong></p> <ol><li><strong>SnapDOM</strong> 提供高保真的 DOM 截图能力，通过 <code>scale: 2</code> 实现 2 倍清晰度</li> <li><strong>jsPDF</strong> 是强大的 PDF 生成库，支持 A4 纸张、压缩等特性</li> <li><strong>分页算法</strong> 是整个方案的核心难点，需要精确计算像素与毫米的转换</li> <li><strong>SnapDOM</strong> 相比 html2canvas 在样式还原度上有明显优势</li></ol> <p><strong>进一步优化方向</strong></p> <table><thead><tr><th>优化点</th> <th>说明</th></tr></thead> <tbody><tr><td><strong>Web Worker</strong></td> <td>将分页计算放到 Worker 中，避免阻塞主线程</td></tr> <tr><td><strong>分段截图</strong></td> <td>超长内容分段截图，避免内存溢出</td></tr> <tr><td><strong>加载提示</strong></td> <td>添加进度条，提升用户体验</td></tr> <tr><td><strong>PDF 压缩</strong></td> <td>使用 pdf-lib 进一步压缩 PDF 体积</td></tr> <tr><td><strong>页眉页脚</strong></td> <td>添加页码、时间戳等信息</td></tr></tbody></table> <h2 id="其他参考"><a href="#其他参考" aria-hidden="true" class="header-anchor">#</a> 其他参考</h2> <p><a href="https://juejin.cn/post/7583912637470769203" target="_blank" rel="noopener noreferrer">前端一行代码生成数千页PDF，dompdf.js新增分页功能<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/yulilong/front-end-doc/edit/master/doc/js/blog/007-html转pdf方案.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">12/24/2025, 10:14:49 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/46.9ed06d3b.js" defer></script><script src="/assets/js/app.2afb8482.js" defer></script>
  </body>
</html>
