<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pinia - 状态管理 | 前端知识</title>
    <meta name="description" content="一个总结前端知识的文档网站">
    <link rel="icon" href="/logo.png">
  <script defer="defer" src="/static/jquery.slim.min.js"></script>
  <script defer="defer" src="/static/jquery.fancybox.min.js"></script>
  <link defer="defer" rel="stylesheet" type="text/css" href="/static/jquery.fancybox.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.76f153c4.css" as="style"><link rel="preload" href="/assets/js/app.2afb8482.js" as="script"><link rel="preload" href="/assets/js/238.39113381.js" as="script"><link rel="prefetch" href="/assets/js/10.0ef1013d.js"><link rel="prefetch" href="/assets/js/100.59669d01.js"><link rel="prefetch" href="/assets/js/101.741c2686.js"><link rel="prefetch" href="/assets/js/102.47149e7d.js"><link rel="prefetch" href="/assets/js/103.f1eaf177.js"><link rel="prefetch" href="/assets/js/104.f23808ff.js"><link rel="prefetch" href="/assets/js/105.f5bdad72.js"><link rel="prefetch" href="/assets/js/106.b8157b10.js"><link rel="prefetch" href="/assets/js/107.a275a057.js"><link rel="prefetch" href="/assets/js/108.4906ec1c.js"><link rel="prefetch" href="/assets/js/109.b21c5677.js"><link rel="prefetch" href="/assets/js/11.3ee5972a.js"><link rel="prefetch" href="/assets/js/110.11790a6f.js"><link rel="prefetch" href="/assets/js/111.519e46a2.js"><link rel="prefetch" href="/assets/js/112.856c72b2.js"><link rel="prefetch" href="/assets/js/113.1a9718fd.js"><link rel="prefetch" href="/assets/js/114.98562c57.js"><link rel="prefetch" href="/assets/js/115.dd09f294.js"><link rel="prefetch" href="/assets/js/116.3e697856.js"><link rel="prefetch" href="/assets/js/117.9ed54de6.js"><link rel="prefetch" href="/assets/js/118.837075a7.js"><link rel="prefetch" href="/assets/js/119.eeb7356e.js"><link rel="prefetch" href="/assets/js/12.ef92ad8b.js"><link rel="prefetch" href="/assets/js/120.d76e8c70.js"><link rel="prefetch" href="/assets/js/121.5490f8be.js"><link rel="prefetch" href="/assets/js/122.bf95df47.js"><link rel="prefetch" href="/assets/js/123.1246f4df.js"><link rel="prefetch" href="/assets/js/124.1b332371.js"><link rel="prefetch" href="/assets/js/125.e968eefc.js"><link rel="prefetch" href="/assets/js/126.41b0b42d.js"><link rel="prefetch" href="/assets/js/127.8d532027.js"><link rel="prefetch" href="/assets/js/128.e3d0dd45.js"><link rel="prefetch" href="/assets/js/129.2eec7742.js"><link rel="prefetch" href="/assets/js/13.5d83ca59.js"><link rel="prefetch" href="/assets/js/130.184a5326.js"><link rel="prefetch" href="/assets/js/131.55d5602a.js"><link rel="prefetch" href="/assets/js/132.0739ad32.js"><link rel="prefetch" href="/assets/js/133.eb282834.js"><link rel="prefetch" href="/assets/js/134.9df36c58.js"><link rel="prefetch" href="/assets/js/135.6d3b3c22.js"><link rel="prefetch" href="/assets/js/136.f6fc5239.js"><link rel="prefetch" href="/assets/js/137.13c0c004.js"><link rel="prefetch" href="/assets/js/138.d9558cc8.js"><link rel="prefetch" href="/assets/js/139.450241fe.js"><link rel="prefetch" href="/assets/js/14.bb2ca207.js"><link rel="prefetch" href="/assets/js/140.e1bf74b6.js"><link rel="prefetch" href="/assets/js/141.b02477b9.js"><link rel="prefetch" href="/assets/js/142.2d68a06d.js"><link rel="prefetch" href="/assets/js/143.c47820a5.js"><link rel="prefetch" href="/assets/js/144.17e6f31d.js"><link rel="prefetch" href="/assets/js/145.2e8592c6.js"><link rel="prefetch" href="/assets/js/146.720781fb.js"><link rel="prefetch" href="/assets/js/147.bf3ed75b.js"><link rel="prefetch" href="/assets/js/148.9505073e.js"><link rel="prefetch" href="/assets/js/149.f9dd6c7c.js"><link rel="prefetch" href="/assets/js/15.16c14ea6.js"><link rel="prefetch" href="/assets/js/150.90a127d0.js"><link rel="prefetch" href="/assets/js/151.9d50afd2.js"><link rel="prefetch" href="/assets/js/152.fbecf0f6.js"><link rel="prefetch" href="/assets/js/153.32c2bb94.js"><link rel="prefetch" href="/assets/js/154.3c5424d9.js"><link rel="prefetch" href="/assets/js/155.4587c969.js"><link rel="prefetch" href="/assets/js/156.b40288c2.js"><link rel="prefetch" href="/assets/js/157.edd410f1.js"><link rel="prefetch" href="/assets/js/158.ada22e21.js"><link rel="prefetch" href="/assets/js/159.ae4e1769.js"><link rel="prefetch" href="/assets/js/16.70266c95.js"><link rel="prefetch" href="/assets/js/160.1c2e95e3.js"><link rel="prefetch" href="/assets/js/161.764559ae.js"><link rel="prefetch" href="/assets/js/162.f3834de5.js"><link rel="prefetch" href="/assets/js/163.17919df8.js"><link rel="prefetch" href="/assets/js/164.a9b1a7d4.js"><link rel="prefetch" href="/assets/js/165.e649e97a.js"><link rel="prefetch" href="/assets/js/166.02532372.js"><link rel="prefetch" href="/assets/js/167.7d112130.js"><link rel="prefetch" href="/assets/js/168.90c0dfba.js"><link rel="prefetch" href="/assets/js/169.d313ed3c.js"><link rel="prefetch" href="/assets/js/17.1f842ac0.js"><link rel="prefetch" href="/assets/js/170.4d971d67.js"><link rel="prefetch" href="/assets/js/171.6a5296d2.js"><link rel="prefetch" href="/assets/js/172.388c5f2d.js"><link rel="prefetch" href="/assets/js/173.8724128a.js"><link rel="prefetch" href="/assets/js/174.0bee9e04.js"><link rel="prefetch" href="/assets/js/175.0e539288.js"><link rel="prefetch" href="/assets/js/176.69aebc77.js"><link rel="prefetch" href="/assets/js/177.e321e16b.js"><link rel="prefetch" href="/assets/js/178.7a6767c2.js"><link rel="prefetch" href="/assets/js/179.b1cd3d26.js"><link rel="prefetch" href="/assets/js/18.958e91d3.js"><link rel="prefetch" href="/assets/js/180.aa4e26e5.js"><link rel="prefetch" href="/assets/js/181.373fea9f.js"><link rel="prefetch" href="/assets/js/182.00faf1e3.js"><link rel="prefetch" href="/assets/js/183.f5084718.js"><link rel="prefetch" href="/assets/js/184.d853e461.js"><link rel="prefetch" href="/assets/js/185.b0233d58.js"><link rel="prefetch" href="/assets/js/186.46563f8c.js"><link rel="prefetch" href="/assets/js/187.8f099752.js"><link rel="prefetch" href="/assets/js/188.3d2adfff.js"><link rel="prefetch" href="/assets/js/189.56085996.js"><link rel="prefetch" href="/assets/js/19.29243772.js"><link rel="prefetch" href="/assets/js/190.74ee9249.js"><link rel="prefetch" href="/assets/js/191.2912c7b3.js"><link rel="prefetch" href="/assets/js/192.816999ff.js"><link rel="prefetch" href="/assets/js/193.66e79d51.js"><link rel="prefetch" href="/assets/js/194.a0aef591.js"><link rel="prefetch" href="/assets/js/195.ca729864.js"><link rel="prefetch" href="/assets/js/196.5f2550df.js"><link rel="prefetch" href="/assets/js/197.53a5a951.js"><link rel="prefetch" href="/assets/js/198.9b7fd80a.js"><link rel="prefetch" href="/assets/js/199.7d76d45a.js"><link rel="prefetch" href="/assets/js/20.65ee3cb2.js"><link rel="prefetch" href="/assets/js/200.beed8c2d.js"><link rel="prefetch" href="/assets/js/201.60704fe0.js"><link rel="prefetch" href="/assets/js/202.0f40a335.js"><link rel="prefetch" href="/assets/js/203.c4a08479.js"><link rel="prefetch" href="/assets/js/204.f281776c.js"><link rel="prefetch" href="/assets/js/205.486b8447.js"><link rel="prefetch" href="/assets/js/206.b9d6473d.js"><link rel="prefetch" href="/assets/js/207.0100e25c.js"><link rel="prefetch" href="/assets/js/208.1f4aeb54.js"><link rel="prefetch" href="/assets/js/209.421e2a33.js"><link rel="prefetch" href="/assets/js/21.f02a2061.js"><link rel="prefetch" href="/assets/js/210.1c1f9f92.js"><link rel="prefetch" href="/assets/js/211.033ec43d.js"><link rel="prefetch" href="/assets/js/212.eaedd29f.js"><link rel="prefetch" href="/assets/js/213.8fa26e5f.js"><link rel="prefetch" href="/assets/js/214.b09ab61f.js"><link rel="prefetch" href="/assets/js/215.ba27a46e.js"><link rel="prefetch" href="/assets/js/216.3d36839f.js"><link rel="prefetch" href="/assets/js/217.c408db8c.js"><link rel="prefetch" href="/assets/js/218.8d420404.js"><link rel="prefetch" href="/assets/js/219.024c3aff.js"><link rel="prefetch" href="/assets/js/22.77807269.js"><link rel="prefetch" href="/assets/js/220.5cd1fed8.js"><link rel="prefetch" href="/assets/js/221.c8398355.js"><link rel="prefetch" href="/assets/js/222.eee93b67.js"><link rel="prefetch" href="/assets/js/223.890a46b1.js"><link rel="prefetch" href="/assets/js/224.af9ae0f2.js"><link rel="prefetch" href="/assets/js/225.64543242.js"><link rel="prefetch" href="/assets/js/226.67eb4e8b.js"><link rel="prefetch" href="/assets/js/227.9dea1e95.js"><link rel="prefetch" href="/assets/js/228.9fd3cd8c.js"><link rel="prefetch" href="/assets/js/229.e3bb4f30.js"><link rel="prefetch" href="/assets/js/23.04033c47.js"><link rel="prefetch" href="/assets/js/230.fd5e90a4.js"><link rel="prefetch" href="/assets/js/231.77d39633.js"><link rel="prefetch" href="/assets/js/232.0fb9b697.js"><link rel="prefetch" href="/assets/js/233.9fd67d1e.js"><link rel="prefetch" href="/assets/js/234.df71f2f9.js"><link rel="prefetch" href="/assets/js/235.72c89c6a.js"><link rel="prefetch" href="/assets/js/236.71d9c1f7.js"><link rel="prefetch" href="/assets/js/237.291e0d2b.js"><link rel="prefetch" href="/assets/js/239.468bdffb.js"><link rel="prefetch" href="/assets/js/24.d5ebdf50.js"><link rel="prefetch" href="/assets/js/240.6a6ca3de.js"><link rel="prefetch" href="/assets/js/241.f9a26874.js"><link rel="prefetch" href="/assets/js/242.9d8553eb.js"><link rel="prefetch" href="/assets/js/25.56b8443d.js"><link rel="prefetch" href="/assets/js/26.c90580d1.js"><link rel="prefetch" href="/assets/js/27.ec93c7fa.js"><link rel="prefetch" href="/assets/js/28.38543972.js"><link rel="prefetch" href="/assets/js/29.2d9ac121.js"><link rel="prefetch" href="/assets/js/3.9c9ba874.js"><link rel="prefetch" href="/assets/js/30.566c00ec.js"><link rel="prefetch" href="/assets/js/31.840c7368.js"><link rel="prefetch" href="/assets/js/32.085a9b53.js"><link rel="prefetch" href="/assets/js/33.2568f008.js"><link rel="prefetch" href="/assets/js/34.c693b23c.js"><link rel="prefetch" href="/assets/js/35.0b12ec66.js"><link rel="prefetch" href="/assets/js/36.5de34291.js"><link rel="prefetch" href="/assets/js/37.316e55e2.js"><link rel="prefetch" href="/assets/js/38.fedb1c7b.js"><link rel="prefetch" href="/assets/js/39.3903f3e4.js"><link rel="prefetch" href="/assets/js/4.e2e10cba.js"><link rel="prefetch" href="/assets/js/40.b458a04d.js"><link rel="prefetch" href="/assets/js/41.51efbc84.js"><link rel="prefetch" href="/assets/js/42.5c079c5c.js"><link rel="prefetch" href="/assets/js/43.d67826ec.js"><link rel="prefetch" href="/assets/js/44.e4379bb2.js"><link rel="prefetch" href="/assets/js/45.d1573aa8.js"><link rel="prefetch" href="/assets/js/46.9ed06d3b.js"><link rel="prefetch" href="/assets/js/47.44c98776.js"><link rel="prefetch" href="/assets/js/48.8bcc4819.js"><link rel="prefetch" href="/assets/js/49.ad20e965.js"><link rel="prefetch" href="/assets/js/5.9862dc9a.js"><link rel="prefetch" href="/assets/js/50.e8fde2ac.js"><link rel="prefetch" href="/assets/js/51.73d7229f.js"><link rel="prefetch" href="/assets/js/52.250dc5fe.js"><link rel="prefetch" href="/assets/js/53.f604ad65.js"><link rel="prefetch" href="/assets/js/54.1c7de7b1.js"><link rel="prefetch" href="/assets/js/55.4d268d71.js"><link rel="prefetch" href="/assets/js/56.9da1ef8f.js"><link rel="prefetch" href="/assets/js/57.5a47f404.js"><link rel="prefetch" href="/assets/js/58.f02f1dd9.js"><link rel="prefetch" href="/assets/js/59.866dce11.js"><link rel="prefetch" href="/assets/js/6.ab1c77d5.js"><link rel="prefetch" href="/assets/js/60.b747b975.js"><link rel="prefetch" href="/assets/js/61.dbd99295.js"><link rel="prefetch" href="/assets/js/62.64069c98.js"><link rel="prefetch" href="/assets/js/63.ed8b0dd0.js"><link rel="prefetch" href="/assets/js/64.3acd796b.js"><link rel="prefetch" href="/assets/js/65.b9dbfb42.js"><link rel="prefetch" href="/assets/js/66.61b81117.js"><link rel="prefetch" href="/assets/js/67.8d82f096.js"><link rel="prefetch" href="/assets/js/68.e3a8f010.js"><link rel="prefetch" href="/assets/js/69.4f199ada.js"><link rel="prefetch" href="/assets/js/7.32aa26cb.js"><link rel="prefetch" href="/assets/js/70.5b5eccfe.js"><link rel="prefetch" href="/assets/js/71.a19b24f5.js"><link rel="prefetch" href="/assets/js/72.01636d1f.js"><link rel="prefetch" href="/assets/js/73.4ea8ca9c.js"><link rel="prefetch" href="/assets/js/74.624abc0f.js"><link rel="prefetch" href="/assets/js/75.7e0202b6.js"><link rel="prefetch" href="/assets/js/76.7aaabc49.js"><link rel="prefetch" href="/assets/js/77.90e5533f.js"><link rel="prefetch" href="/assets/js/78.3758ee0d.js"><link rel="prefetch" href="/assets/js/79.15d46be1.js"><link rel="prefetch" href="/assets/js/8.cdadef6d.js"><link rel="prefetch" href="/assets/js/80.952bd008.js"><link rel="prefetch" href="/assets/js/81.3f570b43.js"><link rel="prefetch" href="/assets/js/82.62e50e74.js"><link rel="prefetch" href="/assets/js/83.3bf5ea27.js"><link rel="prefetch" href="/assets/js/84.e89c9df3.js"><link rel="prefetch" href="/assets/js/85.b9ec2ec1.js"><link rel="prefetch" href="/assets/js/86.cf032aea.js"><link rel="prefetch" href="/assets/js/87.5b38d42a.js"><link rel="prefetch" href="/assets/js/88.95904b6f.js"><link rel="prefetch" href="/assets/js/89.700238a1.js"><link rel="prefetch" href="/assets/js/9.b8b9f88e.js"><link rel="prefetch" href="/assets/js/90.3371b61c.js"><link rel="prefetch" href="/assets/js/91.5ac22d50.js"><link rel="prefetch" href="/assets/js/92.5edf548a.js"><link rel="prefetch" href="/assets/js/93.7c2caa65.js"><link rel="prefetch" href="/assets/js/94.af97350f.js"><link rel="prefetch" href="/assets/js/95.977e351c.js"><link rel="prefetch" href="/assets/js/96.783365c1.js"><link rel="prefetch" href="/assets/js/97.1c56ba20.js"><link rel="prefetch" href="/assets/js/98.8bec8d2e.js"><link rel="prefetch" href="/assets/js/99.30c76886.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.102ccaf5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.76f153c4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="前端知识" class="logo"> <span class="site-name can-hide">前端知识</span></a> <div class="links" style="max-width:nullpx;"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/catalog.html" class="nav-link">目录</a></div><div class="nav-item"><a href="/doc/es6/" class="nav-link">ES6</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/js/" class="nav-link">js</a></li><li class="dropdown-item"><!----> <a href="/doc/js/standardLibrary/" class="nav-link">js标准库</a></li><li class="dropdown-item"><!----> <a href="/doc/dom/" class="nav-link">dom操作文档</a></li><li class="dropdown-item"><!----> <a href="/doc/designPattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/doc/browserNetwork/" class="nav-link">浏览器</a></div><div class="nav-item"><a href="/doc/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/doc/react/" class="nav-link">react</a></div><div class="nav-item"><a href="/doc/vue/" class="nav-link router-link-active">vue</a></div><div class="nav-item"><a href="/doc/typeScript/" class="nav-link">TypeScript</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/doc/node/" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/doc/tool/" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/doc/tool/echarts/" class="nav-link">echarts</a></li><li class="dropdown-item"><!----> <a href="/doc/problem/" class="nav-link">常见问题</a></li></ul></div></div> <a href="https://github.com/yulilong/front-end-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/catalog.html" class="nav-link">目录</a></div><div class="nav-item"><a href="/doc/es6/" class="nav-link">ES6</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/js/" class="nav-link">js</a></li><li class="dropdown-item"><!----> <a href="/doc/js/standardLibrary/" class="nav-link">js标准库</a></li><li class="dropdown-item"><!----> <a href="/doc/dom/" class="nav-link">dom操作文档</a></li><li class="dropdown-item"><!----> <a href="/doc/designPattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/doc/browserNetwork/" class="nav-link">浏览器</a></div><div class="nav-item"><a href="/doc/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/doc/react/" class="nav-link">react</a></div><div class="nav-item"><a href="/doc/vue/" class="nav-link router-link-active">vue</a></div><div class="nav-item"><a href="/doc/typeScript/" class="nav-link">TypeScript</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/doc/node/" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/doc/tool/" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/doc/tool/echarts/" class="nav-link">echarts</a></li><li class="dropdown-item"><!----> <a href="/doc/problem/" class="nav-link">常见问题</a></li></ul></div></div> <a href="https://github.com/yulilong/front-end-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/doc/vue/001-vue遇到的问题.html" class="sidebar-link">VUE遇到的问题</a></li><li><a href="/doc/vue/002-vue常用语法.html" class="sidebar-link">VUE常用语法</a></li><li><a href="/doc/vue/003-vue教程.html" class="sidebar-link">vue教程</a></li><li><a href="/doc/vue/004-vue生命周期.html" class="sidebar-link">vue 生命周期</a></li><li><a href="/doc/vue/005-vue指令.html" class="sidebar-link">vue指令</a></li><li><a href="/doc/vue/006-vue-scoped-css.html" class="sidebar-link">vue Scoped CSS</a></li><li><a href="/doc/vue/007-vue访问根父子组件-依赖注入.html" class="sidebar-link">vue访问根组件、父组件、子组件、依赖注入</a></li><li><a href="/doc/vue/008-vue知识点思维导图.html" class="sidebar-link">vue知识点思维导图</a></li><li><a href="/doc/vue/009-vuex使用文档.html" class="sidebar-link">Vuex 使用说明</a></li><li><a href="/doc/vue/010-vue-cli使用文档.html" class="sidebar-link">Vue CLI使用文档</a></li><li><a href="/doc/vue/011-router使用相关.html" class="sidebar-link">router使用相关</a></li><li><a href="/doc/vue/012-一个vue组件代码写法.html" class="sidebar-link">一个vue组件代码写法</a></li><li><a href="/doc/vue/013-vue的diff算法详解.html" class="sidebar-link">Vue diff算法详解</a></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>VUE3</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc/vue/vue3/" class="sidebar-link">简介</a></li><li><a href="/doc/vue/vue3/001-vue3开发遇到的问题.html" class="sidebar-link">VUE3 开发遇到的问题</a></li><li><a href="/doc/vue/vue3/002-vue3核心语法.html" class="sidebar-link">VUE3核心语法</a></li><li><a href="/doc/vue/vue3/003-vue3其他API和新组件.html" class="sidebar-link">Vue 3 其他API和新组件</a></li><li><a href="/doc/vue/vue3/004-vue3生命周期.html" class="sidebar-link">Vue 3 的生命周期</a></li><li><a href="/doc/vue/vue3/005-vue3组件通信.html" class="sidebar-link">组件通信</a></li><li><a href="/doc/vue/vue3/006-vue3事件.html" class="sidebar-link">事件</a></li><li><a href="/doc/vue/vue3/007-vue3常用语法.html" class="sidebar-link">vue3中常用语法</a></li><li><a href="/doc/vue/vue3/009-vue3单文件CSS.html" class="sidebar-link">Vue3 单文件组件 CSS 功能</a></li><li><a href="/doc/vue/vue3/019-vue-router4.x.html" class="sidebar-link">vue3的路由vue-router4.x.x</a></li><li><a href="/doc/vue/vue3/020-pinia状态管理.html" class="one-level one-level-active active sidebar-link">Pinia - 状态管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/vue/vue3/020-pinia状态管理.html#_1-简介" class="sidebar-link">1. 简介</a></li><li class="sidebar-sub-header"><a href="/doc/vue/vue3/020-pinia状态管理.html#_2-搭建-pinia-环境" class="sidebar-link">2. 搭建 pinia 环境</a></li><li class="sidebar-sub-header"><a href="/doc/vue/vue3/020-pinia状态管理.html#_3-修改store变量" class="sidebar-link">3. 修改store变量</a></li><li class="sidebar-sub-header"><a href="/doc/vue/vue3/020-pinia状态管理.html#_4-在组件中使用store属性的几种方法" class="sidebar-link">4. 在组件中使用store属性的几种方法</a></li><li class="sidebar-sub-header"><a href="/doc/vue/vue3/020-pinia状态管理.html#_6-getters" class="sidebar-link">6. getters</a></li><li class="sidebar-sub-header"><a href="/doc/vue/vue3/020-pinia状态管理.html#_7-subscribe" class="sidebar-link">7. $subscribe</a></li><li class="sidebar-sub-header"><a href="/doc/vue/vue3/020-pinia状态管理.html#_8-store调用另外一个store的方法" class="sidebar-link">8. store调用另外一个store的方法</a></li><li class="sidebar-sub-header"><a href="/doc/vue/vue3/020-pinia状态管理.html#_9-一些常见问题" class="sidebar-link">9. 一些常见问题</a></li></ul></li><li><a href="/doc/vue/vue3/099-vite.html" class="sidebar-link">vite 超快的前端构建工具</a></li><li><a href="/doc/vue/vue3/100-新建vue3项目及相关问题.html" class="sidebar-link">新建vue3项目及相关问题</a></li><li><a href="/doc/vue/vue3/101-vite关于低版本浏览器的支持.html" class="sidebar-link">vite对于低版本的浏览器支持处理</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>vue3代码示例</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc/vue/vue3/code-demo/" class="sidebar-link">简介</a></li><li><a href="/doc/vue/vue3/code-demo/01-element-plus组件代码示例1.html" class="sidebar-link">element-plus 代码示例</a></li><li><a href="/doc/vue/vue3/code-demo/20-代码示例1.html" class="sidebar-link">代码示例1</a></li><li><a href="/doc/vue/vue3/code-demo/30-富文本编辑器的使用.html" class="sidebar-link">富文本编辑器使用</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><p></p><div class="table-of-contents"><ul><li><a href="#_1-简介">1. 简介</a></li><li><a href="#_2-搭建-pinia-环境">2. 搭建 pinia 环境</a><ul><li><a href="#_2-1-安装-pinia-包">2.1 安装 pinia 包</a></li><li><a href="#_2-2-创建一个-pinia-实例-根-store-并将其传递给应用：">2.2 创建一个 pinia 实例 (根 store) 并将其传递给应用：</a></li><li><a href="#_2-3-一个完整的store定义文件-src-store-talk-ts-：">2.3 一个完整的store定义文件(src/store/talk.ts)：</a></li></ul></li><li><a href="#_3-修改store变量">3. 修改store变量</a><ul><li><a href="#_3-1-直接修改">3.1 直接修改</a></li><li><a href="#_3-2-多个属性批量修改">3.2 多个属性批量修改</a></li><li><a href="#_3-3-通过store文件中定义的actions方法进行修改">3.3 通过store文件中定义的actions方法进行修改</a></li></ul></li><li><a href="#_4-在组件中使用store属性的几种方法">4. 在组件中使用store属性的几种方法</a><ul><li><a href="#_4-1-直接使用store-最简单">4.1 直接使用store(最简单)</a></li><li><a href="#_4-2-使用storetorefs方法解构store属性">4.2 使用storeToRefs方法解构store属性</a></li><li><a href="#_4-3-用-computed-包裹访问（当需要派生-代理时）">4.3 用 computed 包裹访问（当需要派生/代理时）</a></li><li><a href="#_4-4-错误用法：直接解构-const-userinfo-store">4.4 错误用法：直接解构 const { userInfo } = store</a></li><li><a href="#_4-4-总结">4.4 总结</a></li></ul></li><li><a href="#_6-getters">6. getters</a></li><li><a href="#_7-subscribe">7. $subscribe</a></li><li><a href="#_8-store调用另外一个store的方法">8. store调用另外一个store的方法</a><ul><li><a href="#_8-1-不要在定义外层直接调用">8.1 不要在定义外层直接调用</a></li><li><a href="#_8-2-正确调用时机总结">8.2 正确调用时机总结</a></li><li><a href="#_8-3-如果需要双向调用（两个-store-互相依赖）">8.3 如果需要双向调用（两个 store 互相依赖）</a></li></ul></li><li><a href="#_9-一些常见问题">9. 一些常见问题</a><ul><li><a href="#_9-1-使用const-store-useuserstore-和直接使用useuserstore-有什么区别吗？">9.1 使用const store = useUserStore()和直接使用useUserStore() 有什么区别吗？</a></li></ul></li></ul></div><p></p> <p>[TOC]</p> <h1 id="pinia-状态管理"><a href="#pinia-状态管理" aria-hidden="true" class="header-anchor">#</a> Pinia - 状态管理</h1> <p><a href="https://pinia.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：https://pinia.vuejs.org/zh/</p> <p>Pinia - 符合直觉的  Vue.js 状态管理库，类型安全、可扩展性以及模块化设计。 甚至让你忘记正在使用的是一个状态库。</p> <h2 id="_1-简介"><a href="#_1-简介" aria-hidden="true" class="header-anchor">#</a> 1. 简介</h2> <p>Pinia <a href="https://github.com/vuejs/pinia/commit/06aeef54e2cad66696063c62829dac74e15fd19e" target="_blank" rel="noopener noreferrer">起始<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>于 2019 年 11 月左右的一次实验，其目的是设计一个拥有<a href="https://github.com/vuejs/composition-api" target="_blank" rel="noopener noreferrer">组合式 API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的 Vue 状态管理库。从那时起，我们就倾向于同时支持 Vue 2 和 Vue 3，并且不强制要求开发者使用组合式 API，我们的初心至今没有改变。除了<strong>安装</strong>和 <strong>SSR</strong> 两章之外，其余章节中提到的 API 均支持 Vue 2 和 Vue 3。虽然本文档主要是面向 Vue 3 的用户，但在必要时会标注出 Vue 2 的内容，因此 Vue 2 和 Vue 3 的用户都可以阅读本文档。</p> <p>Pinia 是 Vue 的专属状态管理库，它允许你跨组件或页面共享状态。如果你熟悉组合式 API 的话，你可能会认为可以通过一行简单的 <code>export const state = reactive({})</code> 来共享一个全局状态。对于单页应用来说确实可以，但如果应用在服务器端渲染，这可能会使你的应用暴露出一些<a href="https://cn.vuejs.org/guide/scaling-up/ssr#cross-request-state-pollution" target="_blank" rel="noopener noreferrer">安全漏洞<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 而如果使用 Pinia，即使在小型单页应用中，你也可以获得如下功能：</p> <ul><li>测试工具集</li> <li>插件：可通过插件扩展 Pinia 功能</li> <li>为 JS 开发者提供适当的 TypeScript 支持以及<strong>自动补全</strong>功能。</li> <li>支持服务端渲染</li> <li>Devtools 支持
<ul><li>追踪 actions、mutations 的时间线</li> <li>在组件中展示它们所用到的 Store</li> <li>让调试更容易的 Time travel</li></ul></li> <li>热更新
<ul><li>不必重载页面即可修改 Store</li> <li>开发时可保持当前的 State</li></ul></li></ul> <h2 id="_2-搭建-pinia-环境"><a href="#_2-搭建-pinia-环境" aria-hidden="true" class="header-anchor">#</a> 2. 搭建 pinia 环境</h2> <h3 id="_2-1-安装-pinia-包"><a href="#_2-1-安装-pinia-包" aria-hidden="true" class="header-anchor">#</a> 2.1 安装 pinia 包</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> pinia
<span class="token comment"># 或使用 yarn</span>
yarn add pinia
</code></pre></div><h3 id="_2-2-创建一个-pinia-实例-根-store-并将其传递给应用："><a href="#_2-2-创建一个-pinia-实例-根-store-并将其传递给应用：" aria-hidden="true" class="header-anchor">#</a> 2.2 创建一个 pinia 实例 (根 store) 并将其传递给应用：</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createPinia <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span> <span class="token comment">// 引入createPinia，用于创建pinia</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>

<span class="token keyword">const</span> pinia <span class="token operator">=</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 创建pinia</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>pinia<span class="token punctuation">)</span> <span class="token comment">// 使用插件</span>
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><p>重启服务后，就可以在浏览器的vue插件中看到<code>pinia</code>选项</p> <h3 id="_2-3-一个完整的store定义文件-src-store-talk-ts-："><a href="#_2-3-一个完整的store定义文件-src-store-talk-ts-：" aria-hidden="true" class="header-anchor">#</a> 2.3 一个完整的store定义文件(src/store/talk.ts)：</h3> <ol><li><p>Store是一个保存：<strong>状态</strong>、<strong>业务逻辑</strong> 的实体，每个组件都可以<strong>读取</strong>、<strong>写入</strong>它。</p></li> <li><p>它有三个概念：<code>state</code>、<code>getter</code>、<code>action</code>，相当于组件中的： <code>data</code>、 <code>computed</code> 和 <code>methods</code>。</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入defineStore用于创建store，注意：有的项目可以不用引入，直接使用这个变量</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>defineStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>

<span class="token comment">// 定义并暴露一个store</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useTalkStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'talk'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token comment">// 状态：存储的变量</span>
  <span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      num<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      talkList<span class="token punctuation">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>id<span class="token punctuation">:</span><span class="token string">'da01'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span><span class="token string">'你今天有点怪，哪里怪？怪好看的！'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>id<span class="token punctuation">:</span><span class="token string">'da02'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span><span class="token string">'草莓、蓝莓、蔓越莓，你想我了没？'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 计算：根据状态来计算新变量</span>
  getters<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token comment">// 基本 getter，返回 state 的计算值</span>
    doubleNum<span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>num <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token comment">// 可以访问其他 getter</span>
    <span class="token function">doubleCountNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> number <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>doubleNum <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 动作：执行方法，用来设置状态</span>
  actions<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token comment">// 同步方法</span>
    <span class="token function">setNumber</span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> umber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> num
    <span class="token punctuation">}</span>
    <span class="token comment">// 异步方法</span>
    <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>talkList <span class="token operator">=</span> res<span class="token punctuation">.</span>talkList
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_3-修改store变量"><a href="#_3-修改store变量" aria-hidden="true" class="header-anchor">#</a> 3. 修改store变量</h2> <h3 id="_3-1-直接修改"><a href="#_3-1-直接修改" aria-hidden="true" class="header-anchor">#</a> 3.1 直接修改</h3> <p>当定义好store文件后，可以直接在组件中修改store变量：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> useTalkStore <span class="token keyword">from</span> <span class="token string">'@/store/talk'</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useTalkStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

store<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">66</span>

<span class="token comment">// 下面这种方式也能修改变量</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> storeToRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> num <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
num<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">88</span>
</code></pre></div><h3 id="_3-2-多个属性批量修改"><a href="#_3-2-多个属性批量修改" aria-hidden="true" class="header-anchor">#</a> 3.2 多个属性批量修改</h3> <div class="language-js extra-class"><pre class="language-js"><code>countStore<span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  sum<span class="token punctuation">:</span><span class="token number">999</span><span class="token punctuation">,</span>
  school<span class="token punctuation">:</span><span class="token string">'atguigu'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在一次性修改多个属性的时候。第一种方式每个修改都会触发一次时间线。而第二种方式 是一次性批量修改，只会触发一次 时间线(浏览器vue插件，时间线(TimeLine))。</p> <h3 id="_3-3-通过store文件中定义的actions方法进行修改"><a href="#_3-3-通过store文件中定义的actions方法进行修改" aria-hidden="true" class="header-anchor">#</a> 3.3 通过store文件中定义的actions方法进行修改</h3> <p>如果修改的数据需要一些逻辑处理，则可以直接在定义的store文件里面的actions方法.</p> <p>1、store文件中定义<code>actions</code>方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>

<span class="token comment">// 定义并暴露一个store</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useTalkStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'talk'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span>  num<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 同步操作</span>
    <span class="token function">increment</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span>number<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//操作countStore中的num</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">+=</span> value
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 异步方法：从接口获取数据</span>
    <span class="token function">getNumPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/data'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> data<span class="token punctuation">.</span>num<span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以在调用的地方使用then方法使用data数据</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 异步方法：从接口获取数据</span>
    <span class="token keyword">async</span> <span class="token function">fetchDataAwait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> data<span class="token punctuation">.</span>num<span class="token punctuation">;</span>
        <span class="token keyword">return</span> data <span class="token operator">||</span> <span class="token string">''</span> <span class="token comment">// 调用的地方获取data的值</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error fetching data:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>2、组件中调用方法修改属性：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>useTalkStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./stores/talkStore.ts'</span>
<span class="token keyword">const</span> talkStore <span class="token operator">=</span> <span class="token function">useTalkStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>talkStore<span class="token punctuation">.</span>num <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    talkStore<span class="token punctuation">.</span><span class="token function">getNumPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'设置数据的同时返回数据使用'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 同步形式，getNumPromise()方法使用await也可以</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>talkStore<span class="token punctuation">.</span>num <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> talkStore<span class="token punctuation">.</span><span class="token function">fetchDataAwait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'设置数据的同时返回数据await'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_4-在组件中使用store属性的几种方法"><a href="#_4-在组件中使用store属性的几种方法" aria-hidden="true" class="header-anchor">#</a> 4. 在组件中使用store属性的几种方法</h2> <h3 id="_4-1-直接使用store-最简单"><a href="#_4-1-直接使用store-最简单" aria-hidden="true" class="header-anchor">#</a> 4.1 直接使用store(最简单)</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ store.userInfo?.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useUserStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/stores/user'</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>优点：<br>
1、最简单、直观，不用额外转/ref。<br>
2、响应性保留（Vue 会跟踪 <code>store.userInfo</code>）。</p> <p>缺点：<br>
1、在模板中频繁写 <code>store.xxx</code> 比较啰嗦（但可读性好）。<br>
2、在 <code>&lt;script setup&gt;</code> 里 <strong>不能用对象解构</strong> <code>const { userInfo } = store</code>（那样会丢失响应性），必须直接访问 <code>store.userInfo</code> 或用下面的方法。</p> <p>何时用：想要快速、明确地读写 store，或只用少量字段时优先使用。</p> <h3 id="_4-2-使用storetorefs方法解构store属性"><a href="#_4-2-使用storetorefs方法解构store属性" aria-hidden="true" class="header-anchor">#</a> 4.2 使用storeToRefs方法解构store属性</h3> <p><code>storeToRefs()</code> 是 Pinia 提供的工具函数，用来把 store 的 <strong>state + getter</strong> 属性转换成 <code>ref</code>，从而可以安全地在组件中解构使用，同时保持响应性。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ userInfo }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> storeToRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> userInfo<span class="token punctuation">,</span> isLoading <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>优点：<br>
1、返回的是 <code>ref</code>，可以安全地在 <code>&lt;template&gt;</code> 中直接使用或在 <code>&lt;script&gt;</code> 中解构。<br>
2、保留响应性，和 Composition API 风格一致。<br>
3、TypeScript 支持良好（类型是 <code>Ref&lt;T&gt;</code>）。</p> <p>缺点：<br>
1、需要多写一次 <code>storeToRefs(...)</code>（非常小的成本）。</p> <p>何时用：需要在 <code>&lt;script&gt;</code> 中解构多个字段，或想避免 <code>store.</code> 前缀时。<strong>这是 Pinia 官方推荐</strong>的做法。</p> <p><strong>注意</strong>：<code>pinia</code>提供的<code>storeToRefs</code>只会将数据做转换，而<code>Vue</code>的<code>toRefs</code>会转换<code>store</code>中数据。</p> <h4 id="_4-2-1-storetorefs方法不能结构actions里面的方法"><a href="#_4-2-1-storetorefs方法不能结构actions里面的方法" aria-hidden="true" class="header-anchor">#</a> 4.2.1 storeToRefs方法不能结构actions里面的方法</h4> <p><strong>注意</strong>：<strong><code>storeToRefs()</code> 只能解构 state（状态）和 getter，不能解构 action（方法）</strong>。
如果你试图对 actions 使用它，是不会生效的（它只会忽略掉函数）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// getUserInfo 是store文件中的actions里面的方法</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> userInfo<span class="token punctuation">,</span> getUserInfo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
</code></pre></div><p>上面的代码中<code>getUserInfo</code>实际上是 <code>undefined</code>！,因为 <code>storeToRefs()</code> <strong>不会处理函数（actions）</strong>。</p> <p>Pinia 官方文档也明确指出这一点👇</p> <blockquote><p><code>storeToRefs()</code> only converts the state and getters into refs. Actions are ignored.</p></blockquote> <p>如果想要解构方法，可以使用如下方式：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>isLoading<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>加载中...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span>{{ userInfo?.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>getUserInfo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>刷新用户信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useUserStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/stores/user'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> storeToRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> userInfo<span class="token punctuation">,</span> isLoading <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> getUserInfo <span class="token punctuation">}</span> <span class="token operator">=</span> store  <span class="token comment">// ✅ actions 用普通解构</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h3 id="_4-3-用-computed-包裹访问（当需要派生-代理时）"><a href="#_4-3-用-computed-包裹访问（当需要派生-代理时）" aria-hidden="true" class="header-anchor">#</a> 4.3 用 <code>computed</code> 包裹访问（当需要派生/代理时）</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">.</span>userInfo<span class="token operator">?</span><span class="token punctuation">.</span>name <span class="token operator">?</span><span class="token operator">?</span> <span class="token string">'匿名'</span><span class="token punctuation">)</span>
</code></pre></div><p>优点：<br>
1、可以做派生（加工）逻辑并保持响应性。<br>
2、适合做只读包装或格式化输出。</p> <p>缺点：<br>
1、如果大量字段都用 computed，会稍微啰嗦。</p> <p>何时用：需要对 store 的值做转换、格式化、或保证非空默认值时使用。</p> <h3 id="_4-4-错误用法：直接解构-const-userinfo-store"><a href="#_4-4-错误用法：直接解构-const-userinfo-store" aria-hidden="true" class="header-anchor">#</a> 4.4 错误用法：直接解构 <code>const { userInfo } = store</code></h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ userInfo }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> storeToRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> userInfo <span class="token punctuation">}</span> <span class="token operator">=</span> store <span class="token comment">// 当 store.userInfo 发生变化时，模板中绑定的 userInfo 不会自动更新。</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>问题：这样得到的 <code>userInfo</code> 是普通变量（不是 ref / reactive proxy），将<strong>失去响应性</strong>，模板不会随 store 更新而更新。</p> <p>结论：切勿在组件中用普通解构直接拿 store 的属性；要么直接用 <code>store.xxx</code>，要么用 <code>storeToRefs</code> / <code>computed</code>。</p> <p>例外情况：在组件的方法里面结构获取这一次的值是可以的，因为方法每次执行都会从新结构获取最新的值。</p> <h3 id="_4-4-总结"><a href="#_4-4-总结" aria-hidden="true" class="header-anchor">#</a> 4.4 总结</h3> <p>TypeScript 注意点：</p> <ul><li><code>storeToRefs(store)</code> 返回的每个字段类型为 <code>Ref&lt;T&gt;</code>，编译时更安全。</li> <li>直接 <code>store.userInfo</code> 访问时若需要在 TS 中解构并保留类型/响应性，可用 <code>const { userInfo } = storeToRefs(store)</code>。</li> <li>若 store 的 state 初始化为 <code>null</code>（例如 <code>userInfo: UserInfo | null</code>），模板或 computed 中要做好空值处理。</li></ul> <p>性能与可维护性</p> <ul><li>直接 <code>store.xxx</code> 与 <code>storeToRefs</code> 在渲染性能上差别微小，不用过度担心。</li> <li><code>storeToRefs</code> 在多人协作和大型文件里能避免“响应性丢失”的踩坑，更推荐作为默认做法。</li></ul> <p>推荐总结（实用规则）</p> <ul><li><strong>最推荐（默认）</strong>：在 <code>&lt;script setup&gt;</code> 中用 <code>storeToRefs(store)</code> 解构你要用的字段；模板直接引用这些 refs。</li> <li><strong>想少写代码</strong>：直接在模板中使用 <code>store.userInfo</code>（简单、可靠）。</li> <li><strong>需要加工数据</strong>：用 <code>computed(() =&gt; store.xxx)</code> 做派生。</li> <li><strong>绝对不要</strong>：用普通解构 <code>const { userInfo } = store</code>（会丢失响应性）。</li></ul> <h2 id="_6-getters"><a href="#_6-getters" aria-hidden="true" class="header-anchor">#</a> 6. getters</h2> <ol><li><p>概念：当<code>state</code>中的数据，需要经过处理后再使用时，可以使用<code>getters</code>配置。</p></li> <li><p>追加<code>getters</code>配置。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span> <span class="token comment">// 引入defineStore用于创建store</span>

<span class="token comment">// 定义并暴露一个store</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useCountStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  actions<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      sum<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
      school<span class="token punctuation">:</span><span class="token string">'atguigu'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 计算</span>
  getters<span class="token punctuation">:</span><span class="token punctuation">{</span>
    bigSum<span class="token punctuation">:</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>number <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>sum <span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token function">upperSchool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>string<span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span> school<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>组件中读取数据：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>increment<span class="token punctuation">,</span>decrement<span class="token punctuation">}</span> <span class="token operator">=</span> countStore
<span class="token keyword">let</span> <span class="token punctuation">{</span>sum<span class="token punctuation">,</span>school<span class="token punctuation">,</span>bigSum<span class="token punctuation">,</span>upperSchool<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span>countStore<span class="token punctuation">)</span>
</code></pre></div></li></ol> <h2 id="_7-subscribe"><a href="#_7-subscribe" aria-hidden="true" class="header-anchor">#</a> 7. $subscribe</h2> <p>通过 store 的 <code>$subscribe()</code> 方法侦听 <code>state</code> 及其变化</p> <div class="language-ts extra-class"><pre class="language-ts"><code>talkStore<span class="token punctuation">.</span><span class="token function">$subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mutate<span class="token punctuation">,</span>state<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'LoveTalk'</span><span class="token punctuation">,</span>mutate<span class="token punctuation">,</span>state<span class="token punctuation">)</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'talk'</span><span class="token punctuation">,</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>talkList<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_8-store调用另外一个store的方法"><a href="#_8-store调用另外一个store的方法" aria-hidden="true" class="header-anchor">#</a> 8. store调用另外一个store的方法</h2> <p><strong>可以在一个 store 中调用另一个 store 的方法或 state</strong>，但要<strong>在方法内部（即函数作用域内）调用</strong>，⚠️ <strong>不要在 store 定义顶层直接调用</strong>。</p> <p>例子：</p> <p>1、<code>auth.ts</code>文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// stores/auth.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useAuthStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'auth'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    token<span class="token punctuation">:</span> <span class="token string">'abc123'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>token
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">setToken</span><span class="token punctuation">(</span>newToken<span class="token punctuation">:</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>token <span class="token operator">=</span> newToken
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>2、<code>user.ts</code>文件，会调用<code>auth.ts</code>的store</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useAuthStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./auth'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useUserStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
    token<span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">fetchUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> authStore <span class="token operator">=</span> <span class="token function">useAuthStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// ✅ 在方法内部调用</span>
      <span class="token keyword">const</span> token <span class="token operator">=</span> authStore<span class="token punctuation">.</span>token      <span class="token comment">// 调用属性</span>
      authStore<span class="token punctuation">.</span><span class="token function">setToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token comment">// 调用方法 </span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当前 token:'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>
      <span class="token comment">// ...根据 token 获取用户信息</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_8-1-不要在定义外层直接调用"><a href="#_8-1-不要在定义外层直接调用" aria-hidden="true" class="header-anchor">#</a> 8.1 不要在定义外层直接调用</h3> <p>下面这种写法 ❌ 会导致 <strong>循环依赖或初始化错误</strong>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ❌ 错误写法</span>
<span class="token keyword">const</span> authStore <span class="token operator">=</span> <span class="token function">useAuthStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useUserStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">fetchUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>authStore<span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>❌ 错误原因：<br>
store 定义文件会在应用初始化时被加载，<code>useAuthStore()</code> 此时 Pinia 还未完全注册，可能导致“active pinia was not found”错误。</p> <h3 id="_8-2-正确调用时机总结"><a href="#_8-2-正确调用时机总结" aria-hidden="true" class="header-anchor">#</a> 8.2 正确调用时机总结</h3> <table><thead><tr><th>调用位置</th> <th>是否允许</th> <th>原因</th></tr></thead> <tbody><tr><td>在 store 的 <strong>actions 内部</strong></td> <td>✅ 允许</td> <td>动态引用，不影响初始化</td></tr> <tr><td>在 store 的 <strong>getters 内部</strong></td> <td>⚠️ 不推荐</td> <td>getter 频繁执行，可能造成性能浪费</td></tr> <tr><td>在 store <strong>定义外部顶层</strong></td> <td>❌ 禁止</td> <td>容易循环依赖或初始化错误</td></tr> <tr><td>在组件 <code>setup()</code> 中</td> <td>✅ 允许</td> <td>生命周期正确，Pinia 已初始化</td></tr></tbody></table> <h3 id="_8-3-如果需要双向调用（两个-store-互相依赖）"><a href="#_8-3-如果需要双向调用（两个-store-互相依赖）" aria-hidden="true" class="header-anchor">#</a> 8.3 如果需要双向调用（两个 store 互相依赖）</h3> <p>可以这样做来避免循环依赖：</p> <ul><li>让 <strong>下层 store</strong> 提供通用逻辑</li> <li>让 <strong>上层 store</strong> 调用下层的函数</li> <li>或者把公共逻辑抽成一个 <strong>composable</strong>，比如 <code>useAuthUtils()</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// composables/useAuthUtils.ts</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useAuthUtils</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> authStore <span class="token operator">=</span> <span class="token function">useAuthStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">refreshToken</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> refreshToken <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后在不同 store 中都可以安全使用。</p> <h2 id="_9-一些常见问题"><a href="#_9-一些常见问题" aria-hidden="true" class="header-anchor">#</a> 9. 一些常见问题</h2> <h3 id="_9-1-使用const-store-useuserstore-和直接使用useuserstore-有什么区别吗？"><a href="#_9-1-使用const-store-useuserstore-和直接使用useuserstore-有什么区别吗？" aria-hidden="true" class="header-anchor">#</a> 9.1 使用const store = useUserStore()和直接使用useUserStore() 有什么区别吗？</h3> <p>结论：   在 <strong>大多数情况下</strong>，<code>const store = useUserStore()</code> 和 <code>useUserStore()</code> 表现效果是 <strong>相同的</strong> —— 因为 Pinia 的 <code>useXxxStore()</code> 本身返回的就是一个响应式的全局单例（Store 实例）。</p> <p>但是：**当你要在模板中使用、要结构数据、要在逻辑中多次访问时 —— <strong>保存成变量 (<code>const store = useUserStore()</code>) 更安全、更高效、更语义化</strong>。</p> <p><code>useUserStore()</code> 是什么？<br>
在 <code>defineStore('user', {...})</code> 定义后，Pinia 会生成一个“hook 风格”的函数 <code>useUserStore()</code>，它会：</p> <ul><li><strong>创建或返回一个全局的 Store 实例；</strong></li> <li>这个实例是响应式的；</li> <li>整个应用中，同一个 Store ID 只会有一个实例。</li> <li>所以：<code>useUserStore() === useUserStore()</code> 永远返回同一个对象</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
store<span class="token punctuation">.</span>userInfo
store<span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>写法1：保存到变量,这种写法的优点：</p> <ul><li><strong>语义清晰</strong>：<code>store.xxx</code> 一看就知道是 Store 内的东西；</li> <li><strong>便于结构</strong>：可以配合 <code>storeToRefs(store)</code>；</li> <li><strong>利于类型推导</strong>：TypeScript 能推导出 store 的完整类型；</li> <li><strong>易于重用</strong>：多处逻辑复用时不必重复调用。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>userInfo
<span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>写法2：直接调用，这种写法虽然可以用，但有以下缺点：</p> <ul><li><p>❌ <strong>重复调用</strong>：虽然底层是同一个实例，但每次调用都要经过一次查找；</p></li> <li><p>❌ <strong>不直观</strong>：可读性较差，不容易看出属于哪个 store；</p></li> <li><p>❌ <strong>不便结构</strong>：你无法像 <code>const { userInfo } = storeToRefs(store)</code> 那样简洁使用；</p></li> <li><p>❌ <strong>watch / computed 中重复写</strong> 时显得臃肿。</p></li> <li><p>特别说明：不会创建多个实例。有的同学担心：我在一个组件里多次调用 <code>useUserStore()</code> 会不会创建多个 store？不会。Pinia 内部会缓存同一个 ID 的 store 实例。所以它们操作的都是同一份状态。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">===</span> b<span class="token punctuation">)</span> <span class="token comment">// true ✅</span>
</code></pre></div></li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/yulilong/front-end-doc/edit/master/doc/vue/vue3/020-pinia状态管理.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">11/14/2025, 4:40:47 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/238.39113381.js" defer></script><script src="/assets/js/app.2afb8482.js" defer></script>
  </body>
</html>
