(window.webpackJsonp=window.webpackJsonp||[]).push([[190],{679:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("p"),t._m(0),a("p"),t._v(" "),a("p",[t._v("[TOC]")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),a("p",[t._v("Node 应用由模块组成，采用 CommonJS 模块规范。")]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),a("p",[t._v("CommonJS模块的特点如下：")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),a("p",[t._v("如下代码：")]),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._m(13),t._v(" "),t._m(14),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),a("p",[t._v("上面模块会在加载后1秒后，发出ready事件。其他文件监听该事件，可以写成下面这样。")]),t._v(" "),t._m(18),t._m(19),t._v(" "),a("p",[t._v("为了方便，Node为每个模块提供一个exports变量，指向module.exports。这等同在每个模块头部，有一行这样的命令。")]),t._v(" "),t._m(20),a("p",[t._v("造成的结果是，在对外输出模块接口时，可以向exports对象添加方法。")]),t._v(" "),a("p",[t._v("注意：")]),t._v(" "),t._m(21),t._v(" "),t._m(22),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),a("p",[t._v("a.js:")]),t._v(" "),t._m(27),a("p",[t._v("b.js:")]),t._v(" "),t._m(28),t._m(29),t._v(" "),t._m(30),t._m(31),t._v(" "),a("p",[t._v("c.js")]),t._v(" "),t._m(32),t._m(33),t._v(" "),t._m(34),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),a("p",[t._v("3、如果参数字符串不以“./“或”/“开头，则表示加载的是一个默认提供的核心模块（位于Node的系统安装目录中），或者一个位于各级node_modules目录的已安装模块（全局安装或局部安装）。")]),t._v(" "),t._m(41),t._v(" "),t._m(42),t._v(" "),a("p",[t._v("这样设计的目的是，使得不同的模块可以将所依赖的模块本地化。")]),t._v(" "),t._m(43),t._v(" "),t._m(44),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._m(54),t._v(" "),t._m(55),t._v(" "),t._m(56),t._v(" "),t._m(57),t._m(58),t._v(" "),t._m(59),t._v(" "),t._m(60),t._v(" "),t._m(61),t._v(" "),t._m(62),a("p",[t._v("所以，如果遇到复杂的相对路径，比如下面这样。")]),t._v(" "),t._m(63),t._m(64),t._v(" "),t._m(65),t._m(66),t._v(" "),t._m(67),t._v(" "),a("p",[t._v("如果发生模块的循环加载，即A加载B，B又加载A，则B将加载A的不完整版本。")]),t._v(" "),t._m(68),t._m(69),t._v(" "),t._m(70),a("p",[t._v("修改main.js文件：")]),t._v(" "),t._m(71),a("p",[t._v("执行结果：")]),t._v(" "),t._m(72),a("p",[t._v("上面代码中，第二次加载a.js和b.js时，会直接从缓存读取exports属性，所以a.js和b.js内部的console.log语句都不会执行了。")]),t._v(" "),t._m(73),t._v(" "),t._m(74),t._v(" "),t._m(75),t._v(" "),t._m(76),t._m(77),t._v(" "),t._m(78),t._v(" "),a("p",[t._v("CommonJS模块的加载机制是，输入的是被输出的值的拷贝。也就是说，一旦输出一个值，模块内部的变化就影响不到这个值。")]),t._v(" "),t._m(79),t._m(80),t._v(" "),t._m(81),t._m(82),t._v(" "),t._m(83),t._v(" "),t._m(84),t._v(" "),t._m(85),t._m(86),t._v(" "),t._m(87),t._m(88),t._v(" "),t._m(89),t._v(" "),t._m(90),t._v(" "),t._m(91),t._m(92),t._v(" "),t._m(93),t._v(" "),t._m(94),t._v(" "),a("p",[t._v("新增于: v0.1.27")]),t._v(" "),a("p",[t._v("当前模块的目录名。 相当于 "),a("a",{attrs:{href:"http://nodejs.cn/api/modules.html#modules_filename",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("__filename")]),a("OutboundLink")],1),t._v(" 的 "),a("a",{attrs:{href:"http://nodejs.cn/api/path.html#path_path_dirname_path",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("path.dirname()")]),a("OutboundLink")],1),t._v("。")]),t._v(" "),t._m(95),t._v(" "),t._m(96),t._m(97),t._v(" "),a("p",[t._v("当前模块的文件名。 这是当前的模块文件的绝对路径（符号链接会被解析）。")]),t._v(" "),a("p",[t._v("对于主程序，这不一定与命令行中使用的文件名相同。")]),t._v(" "),t._m(98),t._v(" "),t._m(99),t._m(100),t._v(" "),t._m(101),t._v(" "),t._m(102),t._v(" "),t._m(103),t._v(" "),t._m(104),t._v(" "),t._m(105),t._v(" "),a("p",[t._v("新增于: v0.3.0")]),t._v(" "),a("p",[t._v("被引入的模块将被缓存在这个对象中。 从此对象中删除键值对将会导致下一次 "),a("code",[t._v("require")]),t._v(" 重新加载被删除的模块。 这不适用于"),a("a",{attrs:{href:"http://nodejs.cn/api/addons.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("原生插件"),a("OutboundLink")],1),t._v("，因为它们的重载将会导致错误。")]),t._v(" "),a("p",[t._v("可以添加或替换入口。 在加载原生模块之前会检查此缓存，如果将与原生模块匹配的名称添加到缓存中，则引入调用将不再获取原生模块。 谨慎使用！")]),t._v(" "),t._m(106),t._v(" "),t._m(107),t._v(" "),t._m(108),t._v(" "),a("ul",[a("li",[a("code",[t._v("request")]),t._v(" "),a("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[a("OutboundLink")],1),t._v(" 需要解析的模块路径。")]),t._v(" "),a("li",[t._v("options\n"),a("ul",[a("li",[a("code",[t._v("paths")]),t._v(" (string)从中解析模块位置的路径。 如果存在，则使用这些路径而不是默认的解析路径，但 "),a("a",{attrs:{href:"http://nodejs.cn/api/modules.html#modules_loading_from_the_global_folders",target:"_blank",rel:"noopener noreferrer"}},[t._v("GLOBAL_FOLDERS"),a("OutboundLink")],1),t._v(" 除外，例如 "),a("code",[t._v("$HOME/.node_modules")]),t._v("，它们总是包含在内。 这些路径中的每一个都用作模块解析算法的起点，这意味着从该位置开始检查 "),a("code",[t._v("node_modules")]),t._v(" 层次结构。")])])]),t._v(" "),a("li",[t._v("返回: string字符串")])]),t._v(" "),t._m(109),t._v(" "),t._m(110),t._v(" "),t._m(111),t._v(" "),t._m(112),t._v(" "),t._m(113),t._v(" "),t._m(114),t._v(" "),a("p",[a("a",{attrs:{href:"https://javascript.ruanyifeng.com/nodejs/module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("CommonJS规范 阮一峰"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"http://nodejs.cn/api/modules.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("CommonJS 模块 node"),a("OutboundLink")],1)])])},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#_1-概述"}},[t._v("1. 概述")])]),a("li",[a("a",{attrs:{href:"#_2-module对象"}},[t._v("2. module对象")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-1-module-exports属性-对外输出的接口"}},[t._v("2.1 module.exports属性: 对外输出的接口")])]),a("li",[a("a",{attrs:{href:"#_2-2-exports变量-指向module-exports"}},[t._v("2.2 exports变量:指向module.exports")])])])]),a("li",[a("a",{attrs:{href:"#_3-require命令"}},[t._v("3. require命令")]),a("ul",[a("li",[a("a",{attrs:{href:"#_3-1-加载规则"}},[t._v("3.1 加载规则")])]),a("li",[a("a",{attrs:{href:"#_3-2-目录的加载规则"}},[t._v("3.2 目录的加载规则")])]),a("li",[a("a",{attrs:{href:"#_3-3-模块的缓存"}},[t._v("3.3 模块的缓存")])]),a("li",[a("a",{attrs:{href:"#_3-4-环境变量node-path"}},[t._v("3.4 环境变量NODE_PATH")])]),a("li",[a("a",{attrs:{href:"#_3-5-模块的循环加载"}},[t._v("3.5 模块的循环加载")])]),a("li",[a("a",{attrs:{href:"#_3-6-require-main"}},[t._v("3.6 require.main")])])])]),a("li",[a("a",{attrs:{href:"#_4-模块的加载机制"}},[t._v("4. 模块的加载机制")])]),a("li",[a("a",{attrs:{href:"#_5-require的内部处理流程"}},[t._v("5. require的内部处理流程")])]),a("li",[a("a",{attrs:{href:"#_6-模块内环境变量"}},[t._v("6. 模块内环境变量")]),a("ul",[a("li",[a("a",{attrs:{href:"#_6-1-dirname"}},[t._v("6.1 __dirname")])]),a("li",[a("a",{attrs:{href:"#_6-2-filename"}},[t._v("6.2 __filename")])]),a("li",[a("a",{attrs:{href:"#_6-3-exports"}},[t._v("6.3 exports")])]),a("li",[a("a",{attrs:{href:"#_6-4-require-cache"}},[t._v("6.4 require.cache")])]),a("li",[a("a",{attrs:{href:"#_6-5-require-main"}},[t._v("6.5 require.main")])]),a("li",[a("a",{attrs:{href:"#_6-6-require-resolve-request-options"}},[t._v("6.6 require.resolve(request[, options])")])]),a("li",[a("a",{attrs:{href:"#_6-7-require-resolve-paths-request"}},[t._v("6.7 require.resolve.paths(request)")])])])]),a("li",[a("a",{attrs:{href:"#参考资料"}},[t._v("参考资料")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"commonjs规范"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#commonjs规范","aria-hidden":"true"}},[this._v("#")]),this._v(" CommonJS规范")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-概述","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. 概述")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("每个文件就是一个模块，有自己的作用域。在一个文件里面定义的变量、函数、类，都是私有的，对其他文件不可见。如果想在多个文件分享变量，必须定义为"),s("code",[this._v("global")]),this._v("对象的属性。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("CommonJS规范规定，每个模块内部，"),a("code",[t._v("module")]),t._v("变量代表当前模块。这个变量是一个对象，它的"),a("code",[t._v("exports")]),t._v("属性（即"),a("code",[t._v("module.exports")]),t._v("）是对外的接口。加载某个模块，其实是加载该模块的"),a("code",[t._v("module.exports")]),t._v("属性。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("所有代码都运行在模块作用域，不会污染全局作用域。")]),this._v(" "),s("li",[this._v("模块可以多次加载，但是只会在第一次加载时运行一次，然后运行结果就被缓存了，以后再加载，就直接读取缓存结果。要想让模块再次运行，必须清除缓存。")]),this._v(" "),s("li",[this._v("模块加载的顺序，按照其在代码中出现的顺序。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// example.js")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 变量x和函数addX，是当前文件example.js私有的，其他文件不可见")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" x "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("5")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),a("span",{attrs:{class:"token function-variable function"}},[t._v("addX")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" value "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" x"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// warning变量，可以被所有文件读取。当然，这样写法是不推荐的。")]),t._v("\nglobal"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("warning "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 通过module.exports 对外输出变量x和函数addX。")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" x"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addX "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" addX"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_2-module对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-module对象","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. module对象")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("每个模块内部，都有一个"),s("code",[this._v("module")]),this._v("对象，代表当前模块。它有以下属性。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("code",[t._v("module.children")]),t._v(" 返回一个数组，表示该模块要用到的其他模块。")]),t._v(" "),a("li",[a("code",[t._v("module.exports")]),t._v(" 表示模块对外输出的值。")]),t._v(" "),a("li",[a("code",[t._v("module.filename")]),t._v(" 模块的文件名，带有绝对路径。")]),t._v(" "),a("li",[a("code",[t._v("module.id")]),t._v(" 模块的识别符，通常是带有绝对路径的模块文件名。")]),t._v(" "),a("li",[a("code",[t._v("module.loaded")]),t._v(" 返回一个布尔值，表示模块是否已经完成加载。")]),t._v(" "),a("li",[a("code",[t._v("module.parent")]),t._v(" 返回一个对象，表示调用该模块的模块。新增于: v0.1.16弃用于: v14.6.0, v12.19.0")]),t._v(" "),a("li",[a("code",[t._v("module.path")]),t._v(" 模块的目录名称。通常与 module.id 的 path.dirname() 相同。")]),t._v(" "),a("li",[a("code",[t._v("module.paths")]),t._v(" 模块的搜索路径。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// a.js")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("$")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("say")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("终端使用命令执行"),s("code",[this._v("node a.js")]),this._v("：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("Module "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  id: "),a("span",{attrs:{class:"token string"}},[t._v("'.'")]),t._v(",\n  exports: "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'$'")]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Function: say"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n  parent: null,\n  filename: "),a("span",{attrs:{class:"token string"}},[t._v("'/Users/user/tmp/node-server/a.js'")]),t._v(",\n  loaded: false,\n  children: "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n  paths:\n   "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'/Users/user/tmp/node-server/node_modules'")]),t._v(",\n     "),a("span",{attrs:{class:"token string"}},[t._v("'/Users/user/tmp/node_modules'")]),t._v(",\n     "),a("span",{attrs:{class:"token string"}},[t._v("'/Users/user/node_modules'")]),t._v(",\n     "),a("span",{attrs:{class:"token string"}},[t._v("'/Users/node_modules'")]),t._v(",\n     "),a("span",{attrs:{class:"token string"}},[t._v("'/node_modules'")]),t._v(" \n   "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("由于"),s("code",[this._v("parent")]),this._v("属性表示调用该模块的模块，如果没有人调用就是null，如果被别的文件调用，那么parent属性的值就是调用它的模块，利用这一点，可以判断当前模块是否为入口脚本。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 运行 node a.js")]),t._v("\n    app"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("listen")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("8088")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'app listening on port 8088'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 其他文件 require('/a.js')")]),t._v("\n    module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-1-module-exports属性-对外输出的接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-module-exports属性-对外输出的接口","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.1 module.exports属性: 对外输出的接口")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("module.exports")]),this._v("属性表示当前模块对外输出的接口，其他文件加载该模块，实际上就是读取"),s("code",[this._v("module.exports")]),this._v("变量。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// a.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" EventEmitter "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'events'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EventEmitter"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("EventEmitter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("emit")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'ready'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./a'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\na"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'ready'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'module a is ready'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-2-exports变量-指向module-exports"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-exports变量-指向module-exports","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2 exports变量:指向module.exports")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("不能直接将exports变量指向一个值，因为这样等于切断了"),a("code",[t._v("exports")]),t._v("与"),a("code",[t._v("module.exports")]),t._v("的联系")]),t._v(" "),a("li",[t._v("给exports添加新属性后，不能在重新给"),a("code",[t._v("module.exports")]),t._v("赋值了，否则exports添加新属则没有了")]),t._v(" "),a("li",[t._v("如果一个模块的对外接口，就是一个单一的值，不能使用"),a("code",[t._v("exports")]),t._v("输出，只能使用"),a("code",[t._v("module.exports")]),t._v("输出")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("exports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("area")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Math"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("PI")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" r "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" r"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 上面这样的写法是无效的，因为exports不再指向module.exports了。导致area属性没有了")]),t._v("\n"),a("span",{attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// module.exports被重新赋值了, 导致area没有了。")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Hello world'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 一个模块只是一个单一的值，只能使用module.exports输出")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("如果你觉得，"),a("code",[t._v("exports")]),t._v("与"),a("code",[t._v("module.exports")]),t._v("之间的区别很难分清，一个简单的处理方法，就是放弃使用"),a("code",[t._v("exports")]),t._v("，只使用"),a("code",[t._v("module.exports")]),t._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_3-require命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-require命令","aria-hidden":"true"}},[this._v("#")]),this._v(" 3. require命令")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Node使用CommonJS模块规范，内置的"),s("code",[this._v("require")]),this._v("命令用于加载模块文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("require")]),this._v("命令的基本功能是，读入并执行一个JavaScript文件，然后返回该模块的exports对象。如果没有发现指定模块，会报错。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),a("span",{attrs:{class:"token function-variable function"}},[t._v("invisible")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"invisible"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("invisible")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"hi"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("say")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" example "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'example: '")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" example"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("执行"),s("code",[this._v("node b.js")]),this._v("：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("invisible\nexample:  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" message: "),a("span",{attrs:{class:"token string"}},[t._v("'hi'")]),t._v(", say: "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Function"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果模块输出的是一个函数，那就不能定义在exports对象上面，而要定义在"),s("code",[this._v("module.exports")]),this._v("变量上面。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"hello world"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// require命令调用自身，等于是执行module.exports，因此会输出 hello world")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./c.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("执行"),s("code",[this._v("node c.js")]),this._v("：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[this._v("hello world\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-1-加载规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-加载规则","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.1 加载规则")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("require")]),this._v("命令用于加载文件，后缀名默认为"),s("code",[this._v(".js")]),this._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" foo "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'foo'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//  等同于")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" foo "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'foo.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("根据参数的不同格式，"),s("code",[this._v("require")]),this._v("命令去不同路径寻找模块文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("1、如果参数字符串以“/”开头，则表示加载的是一个位于绝对路径的模块文件。比如，"),s("code",[this._v("require('/home/marco/foo.js')")]),this._v("将加载"),s("code",[this._v("/home/marco/foo.js")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("2、如果参数字符串以“./”开头，则表示加载的是一个位于相对路径（跟当前执行脚本的位置相比）的模块文件。比如，"),s("code",[this._v("require('./circle')")]),this._v("将加载当前脚本同一目录的"),s("code",[this._v("circle.js")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("举例来说，脚本"),s("code",[this._v("/home/user/projects/foo.js")]),this._v("执行了"),s("code",[this._v("require('bar.js')")]),this._v("命令，Node会依次搜索以下文件。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("/usr/local/lib/node/bar.js")]),t._v(" "),a("li",[t._v("/home/user/projects/node_modules/bar.js")]),t._v(" "),a("li",[t._v("/home/user/node_modules/bar.js")]),t._v(" "),a("li",[t._v("/home/node_modules/bar.js")]),t._v(" "),a("li",[t._v("/node_modules/bar.js")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("4、如果参数字符串不以“./“或”/“开头，而且是一个路径，比如"),s("code",[this._v("require('example-module/path/to/file')")]),this._v("，则将先找到"),s("code",[this._v("example-module")]),this._v("的位置，然后再以它为参数，找到后续路径。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("5、如果指定的模块文件没有发现，Node会尝试为文件名添加"),a("code",[t._v(".js")]),t._v("、"),a("code",[t._v(".json")]),t._v("、"),a("code",[t._v(".node")]),t._v("后，再去搜索。"),a("code",[t._v(".js")]),t._v("件会以文本格式的JavaScript脚本文件解析，"),a("code",[t._v(".json")]),t._v("文件会以JSON格式的文本文件解析，"),a("code",[t._v(".node")]),t._v("文件会以编译后的二进制文件解析。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("6、如果想得到"),s("code",[this._v("require")]),this._v("命令加载的确切文件名，使用"),s("code",[this._v("require.resolve()")]),this._v("方法。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-2-目录的加载规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-目录的加载规则","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.2 目录的加载规则")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("通常，我们会把相关的文件会放在一个目录里面，便于组织。这时，最好为该目录设置一个入口文件，让"),s("code",[this._v("require")]),this._v("方法可以通过这个入口文件，加载整个目录。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在目录中放置一个"),s("code",[this._v("package.json")]),this._v("文件，并且将入口文件写入"),s("code",[this._v("main")]),this._v("字段。下面是一个例子。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("// package.json\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n  "),a("span",{attrs:{class:"token property"}},[t._v('"name"')]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"some-library"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"main"')]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"./lib/some-library.js"')]),t._v(" \n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("code",[t._v("require")]),t._v("发现参数字符串指向一个目录以后，会自动查看该目录的"),a("code",[t._v("package.json")]),t._v("文件，然后加载"),a("code",[t._v("main")]),t._v("字段指定的入口文件。如果"),a("code",[t._v("package.json")]),t._v("文件没有"),a("code",[t._v("main")]),t._v("字段，或者根本就没有"),a("code",[t._v("package.json")]),t._v("文件，则会加载该目录下的"),a("code",[t._v("index.js")]),t._v("文件或"),a("code",[t._v("index.node")]),t._v("文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-3-模块的缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-模块的缓存","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.3 模块的缓存")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第一次加载某个模块时，Node会缓存该模块。以后再加载该模块，就直接从缓存取出该模块的"),s("code",[this._v("module.exports")]),this._v("属性。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./example.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./example.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"hello"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./example.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message\n"),a("span",{attrs:{class:"token comment"}},[t._v('// "hello"')]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上面代码中，连续三次使用"),s("code",[this._v("require")]),this._v("命令，加载同一个模块。第二次加载的时候，为输出的对象添加了一个"),s("code",[this._v("message")]),this._v("属性。但是第三次加载的时候，这个message属性依然存在，这就证明"),s("code",[this._v("require")]),this._v("命令并没有重新加载模块文件，而是输出了缓存。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果想要多次执行某个模块，可以让该模块输出一个函数，然后每次"),s("code",[this._v("require")]),this._v("这个模块的时候，重新执行一下输出的函数。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("所有缓存的模块保存在"),s("code",[this._v("require.cache")]),this._v("之中，如果想删除模块的缓存，可以像下面这样写。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 删除指定模块的缓存")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" require"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("moduleName"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 删除所有模块的缓存")]),t._v("\nObject"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("keys")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("require"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("forEach")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" require"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("注意，缓存是根据绝对路径识别模块的，如果同样的模块名，但是保存在不同的路径，"),s("code",[this._v("require")]),this._v("命令还是会重新加载该模块。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-4-环境变量node-path"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-环境变量node-path","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.4 环境变量NODE_PATH")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Node执行一个脚本时，会先查看环境变量"),s("code",[this._v("NODE_PATH")]),this._v("。它是一组以冒号分隔的绝对路径。在其他位置找不到指定模块时，Node会去这些路径查找。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("可以将NODE_PATH添加到"),s("code",[this._v(".bashrc")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("export")]),this._v(" NODE_PATH"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),s("span",{attrs:{class:"token string"}},[this._v('"/usr/local/lib/node"')]),this._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" myModule "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'../../../../lib/myModule'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("有两种解决方法，一是将该文件加入"),s("code",[this._v("node_modules")]),this._v("目录，二是修改"),s("code",[this._v("NODE_PATH")]),this._v("环境变量，"),s("code",[this._v("package.json")]),this._v("文件可以采用下面的写法。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v('{\n  "name": "node_path",\n  "main": "index.js",\n  "scripts": {\n    "start": "NODE_PATH=lib node index.js"\n  },\n}\n')])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("NODE_PATH")]),this._v("是历史遗留下来的一个路径解决方案，通常不应该使用，而应该使用"),s("code",[this._v("node_modules")]),this._v("目录机制。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-5-模块的循环加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-模块的循环加载","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.5 模块的循环加载")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// a.js")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'a1'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'a.js '")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./b.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'a2'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// b.js")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'b1'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'b.js '")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'b2'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'main.js第一行'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'main.js '")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'main.js第3行'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'main.js '")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./b.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上面代码中，执行"),s("code",[this._v("main.js")]),this._v("后， a文件加载了b，而b文件又加载了a。这是，b文件中a返回的是不完整版本，执行结果如下：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ node main.js\nmain.js第一行\nb.js  a1\na.js  b2\nmain.js  a2\nmain.js第3行\nmain.js  b2\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'main.js第一行'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'main.js '")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'main.js第3行'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'main.js '")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./b.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'main.js '")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'main.js '")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./b.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ node main.js\nmain.js第一行\nb.js  a1\na.js  b2\nmain.js  a2\nmain.js第3行\nmain.js  b2\nmain.js  a2\nmain.js  b2\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-6-require-main"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-require-main","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.6 require.main")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("require")]),this._v("方法有一个"),s("code",[this._v("main")]),this._v("属性，可以用来判断模块是直接执行，还是被调用执行。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("直接执行的时候（"),s("code",[this._v("node module.js")]),this._v("），"),s("code",[this._v("require.main")]),this._v("属性指向模块本身。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[this._v("require"),s("span",{attrs:{class:"token punctuation"}},[this._v(".")]),this._v("main "),s("span",{attrs:{class:"token operator"}},[this._v("===")]),this._v(" module\n"),s("span",{attrs:{class:"token comment"}},[this._v("// true")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("调用执行的时候（通过"),s("code",[this._v("require")]),this._v("加载该脚本执行），上面的表达式返回false。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_4-模块的加载机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-模块的加载机制","aria-hidden":"true"}},[this._v("#")]),this._v(" 4. 模块的加载机制")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// b.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" counter "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("incCounter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" counter"),a("span",{attrs:{class:"token operator"}},[t._v("++")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  incCounter"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" incCounter"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上面代码输出内部变量"),s("code",[this._v("counter")]),this._v("和改写这个变量的内部方法"),s("code",[this._v("incCounter")]),this._v("。然后，加载上面的模块。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" counter "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./b'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" incCounter "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./b'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("incCounter"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{attrs:{class:"token comment"}},[t._v("// 3")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("incCounter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("counter"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 3")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上面代码说明，"),s("code",[this._v("counter")]),this._v("输出以后，"),s("code",[this._v("lib.js")]),this._v("模块内部的变化就影响不到"),s("code",[this._v("counter")]),this._v("了。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_5-require的内部处理流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-require的内部处理流程","aria-hidden":"true"}},[this._v("#")]),this._v(" 5. require的内部处理流程")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("require")]),this._v("命令是CommonJS规范之中，用来加载其他模块的命令。它其实不是一个全局命令，而是指向当前模块的"),s("code",[this._v("module.require")]),this._v("命令，而后者又调用Node的内部命令"),s("code",[this._v("Module._load")]),this._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("Module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("_load")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" parent"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" isMain"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 1. 检查 Module._cache，是否缓存之中有指定模块")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 2. 如果缓存之中没有，就创建一个新的Module实例")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 3. 将它保存到缓存")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 4. 使用 module.load() 加载指定的模块文件，")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("//    读取文件内容之后，使用 module.compile() 执行文件代码")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 5. 如果加载/解析过程报错，就从缓存删除该模块")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 6. 返回该模块的 module.exports")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上面的第4步，采用"),s("code",[this._v("module.compile()")]),this._v("执行指定模块的脚本，逻辑如下：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("Module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("_compile")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filename"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 1. 生成一个require函数，指向module.require")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 2. 加载其他辅助方法到require")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 3. 将文件内容放到一个函数之中，该函数可调用 require")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 4. 执行该函数")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上面的第1步和第2步，"),s("code",[this._v("require")]),this._v("函数及其辅助方法主要如下。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("code",[t._v("require()")]),t._v(": 加载外部模块")]),t._v(" "),a("li",[a("code",[t._v("require.resolve()")]),t._v("：将模块名解析到一个绝对路径")]),t._v(" "),a("li",[a("code",[t._v("require.main")]),t._v("：指向主模块")]),t._v(" "),a("li",[a("code",[t._v("require.cache")]),t._v("：指向所有缓存的模块")]),t._v(" "),a("li",[a("code",[t._v("require.extensions")]),t._v("：根据文件的后缀名，调用不同的执行函数")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("一旦"),a("code",[t._v("require")]),t._v("函数准备完毕，整个所要加载的脚本内容，就被放到一个新的函数之中，这样可以避免污染全局环境。该函数的参数包括"),a("code",[t._v("require")]),t._v("、"),a("code",[t._v("module")]),t._v("、"),a("code",[t._v("exports")]),t._v("，以及其他一些参数。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exports"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" require"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" module"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __filename"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// YOUR CODE INJECTED HERE!")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Module._compile")]),this._v("方法是同步执行的，所以"),s("code",[this._v("Module._load")]),this._v("要等它执行完成，才会向用户返回"),s("code",[this._v("module.exports")]),this._v("的值。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_6-模块内环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-模块内环境变量","aria-hidden":"true"}},[this._v("#")]),this._v(" 6. 模块内环境变量")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_6-1-dirname"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-dirname","aria-hidden":"true"}},[this._v("#")]),this._v(" 6.1 __dirname")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("从 "),s("code",[this._v("/Users/mjr")]),this._v(" 运行 "),s("code",[this._v("node example.js")]),this._v("：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 打印: /Users/mjr")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("dirname")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__filename"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 打印: /Users/mjr")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_6-2-filename"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-filename","aria-hidden":"true"}},[this._v("#")]),this._v(" 6.2 __filename")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("从 "),s("code",[this._v("/Users/mjr")]),this._v(" 运行 "),s("code",[this._v("node example.js")]),this._v("：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__filename"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 打印: /Users/mjr/example.js")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 打印: /Users/mjr")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("给定两个模块："),a("code",[t._v("a")]),t._v(" 和 "),a("code",[t._v("b")]),t._v("，其中 "),a("code",[t._v("b")]),t._v(" 是 "),a("code",[t._v("a")]),t._v(" 的依赖文件，且目录结构如下：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("code",[this._v("/Users/mjr/app/a.js")])]),this._v(" "),s("li",[s("code",[this._v("/Users/mjr/app/node_modules/b/b.js")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("code",[t._v("b.js")]),t._v(" 中的 "),a("code",[t._v("__filename")]),t._v(" 的引用会返回 "),a("code",[t._v("/Users/mjr/app/node_modules/b/b.js")]),t._v("，而 "),a("code",[t._v("a.js")]),t._v(" 中的 "),a("code",[t._v("__filename")]),t._v(" 的引用会返回 "),a("code",[t._v("/Users/mjr/app/a.js")]),t._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_6-3-exports"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-exports","aria-hidden":"true"}},[this._v("#")]),this._v(" 6.3 exports")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这是一个对于 "),s("code",[this._v("module.exports")]),this._v(" 的更简短的引用形式")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_6-4-require-cache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-require-cache","aria-hidden":"true"}},[this._v("#")]),this._v(" 6.4 require.cache")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_6-5-require-main"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-require-main","aria-hidden":"true"}},[this._v("#")]),this._v(" 6.5 require.main")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Module")]),this._v(" 对象，表示当 Node.js 进程启动时加载的入口脚本。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_6-6-require-resolve-request-options"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-require-resolve-request-options","aria-hidden":"true"}},[this._v("#")]),this._v(" 6.6 require.resolve(request[, options])")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用内部的 "),s("code",[this._v("require()")]),this._v(" 机制查询模块的位置，此操作只返回解析后的文件名，不会加载该模块。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果找不到模块，则会抛出 "),s("code",[this._v("MODULE_NOT_FOUND")]),this._v(" 错误。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_6-7-require-resolve-paths-request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-7-require-resolve-paths-request","aria-hidden":"true"}},[this._v("#")]),this._v(" 6.7 require.resolve.paths(request)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("request：字符串，被查询解析路径的模块的路径。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("返回一个数组，其中包含解析 "),a("code",[t._v("request")]),t._v(" 过程中被查询的路径，如果 "),a("code",[t._v("request")]),t._v(" 字符串指向核心模块（例如 "),a("code",[t._v("http")]),t._v(" 或 "),a("code",[t._v("fs")]),t._v("）则返回 "),a("code",[t._v("null")]),t._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考资料")])}],!1,null,null,null);e.options.__file="003-CommonJS规范.md";s.default=e.exports}}]);